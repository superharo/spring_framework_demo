> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [www.iocoder.cn](https://www.iocoder.cn/Spring-Boot/Actuator/?self)

> æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Spring-Boot/Actuator/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼ 1. æ¦‚è¿° 2. å¿«é€Ÿå…¥é—¨ 3. å†…ç½®ç«¯ç‚¹ 4. he......

<div id="locker" style="display: block;"> <div class="mask"></div> <div class="info"> <div> <p class="text-center" style="color: black;"> æ‰«ç å…³æ³¨å…¬ä¼—å·ï¼š<span style="color: #E9405A; font-weight: bold;"> èŠ‹é“æºç  </span></p> <p class="text-center"></p> <p class="text-center"> <span style="color: black;"> å‘é€ï¼š</span> <span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;"> ç™¾äº‹å¯ä¹ </span> <br> <span style="color: black;"> è·å–æ°¸ä¹…è§£é”æœ¬ç«™å…¨éƒ¨æ–‡ç« çš„é“¾æ¥ </span> </p> </div> <div class="text-center"> <img class="code-img" style="width: 300px" src="/images/common/erweima.jpg"> </div> </div> </div>

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Spring-Boot/Actuator/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

*   [1. æ¦‚è¿°](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [2. å¿«é€Ÿå…¥é—¨](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [3. å†…ç½®ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [4. health ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [5. info ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [6. metrics ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [7. httptrace ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [8. auditevents ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [9. beans ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [10. conditions ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [11. env ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [12. configprops ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [13. mappings ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [14. loggers ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [15. threaddump ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [16. heapdump ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [17. shutdown ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [18. sessions ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [19. scheduledtasks ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [20. flyway ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [21. liquibase ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [22. è‡ªå®šä¹‰ç«¯ç‚¹](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [23. è‡ªå®šä¹‰ç«¯å£](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [24. å®‰å…¨è®¤è¯](http://www.iocoder.cn/Spring-Boot/Actuator/)
*   [666. å½©è›‹](http://www.iocoder.cn/Spring-Boot/Actuator/)

> æœ¬æ–‡åœ¨æä¾›å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¯è§ [https://github.com/YunaiV/SpringBoot-Labs](https://github.com/YunaiV/SpringBoot-Labs) çš„ [lab-34](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-34) ç›®å½•ã€‚
> 
> åŸåˆ›ä¸æ˜“ï¼Œç»™ç‚¹ä¸ª [Star](https://github.com/YunaiV/SpringBoot-Labs/stargazers) å˜¿ï¼Œä¸€èµ·å†²é¸­ï¼

ç°åœ¨åœ¨é˜…è¯»æœ¬æ–‡çš„èƒ–å‹ï¼Œä¼°è®¡ç»å¤§å¤šæ•°éƒ½æ˜¯ Java å¼€å‘è€…ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªå…³å¿ƒ**å¼€å‘**éƒ¨åˆ†ï¼Œä½†æ˜¯åº”ç”¨åœ¨éƒ¨ç½²åœ¨**ç”Ÿäº§ç¯å¢ƒ**ä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘åº”ç”¨çš„**ç®¡ç†ä¸ç›‘æ§**ã€‚ä¾‹å¦‚è¯´ï¼Œåº”ç”¨æ˜¯å¦å¥åº·å­˜æ´»ã€åº”ç”¨çš„ JVM ç›‘æ§ä¿¡æ¯ã€æœåŠ¡å™¨çš„ç›‘æ§ä¿¡æ¯ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ç­‰ï¼‰ã€‚

å¦‚æœæˆ‘ä»¬ä¸ºåº”ç”¨çš„ç®¡ç†ä¸ç›‘æ§åšç›¸åº”çš„å¼€å‘ï¼Œæ˜¯éœ€è¦ä¸€å®šçš„æˆæœ¬çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ Spring Boot æ¡†æ¶æä¾›äº†ä¸€ä¸ªéå¸¸é‡è¦çš„**æ–°ç»„ä»¶** [spring-boot-actuator](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-actuator) ã€‚å…¶æ–‡æ¡£ä»‹ç»å¦‚ä¸‹ï¼š

> FROM [ã€ŠSpring Boot Actuator: Production-ready Featuresã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html)
> 
> Spring Boot includes a number of additional features to help you monitor and manage your application when you push it to production.  
> Spring Boot åŒ…å«è®¸å¤šé™„åŠ åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åœ¨å°†åº”ç”¨ç¨‹åºæ¨å‘ç”Ÿäº§ç¯å¢ƒæ—¶å¯¹å…¶è¿›è¡Œç›‘è§†å’Œç®¡ç†ã€‚
> 
> You can choose to manage and monitor your application by using HTTP endpoints or with JMX. æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨ HTTP ç«¯ç‚¹æˆ– JMX æ¥ç®¡ç†å’Œç›‘è§†åº”ç”¨ç¨‹åºã€‚
> 
> Auditing, health, and metrics gathering can also be automatically applied to your application.
> 
> å®¡è®¡ï¼ˆauditingï¼‰ã€å¥åº·çŠ¶å†µï¼ˆhealthï¼‰å’ŒæŒ‡æ ‡ï¼ˆmetricsï¼‰æ”¶é›†ä¹Ÿå¯ä»¥è‡ªåŠ¨åº”ç”¨åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚

å¯èƒ½å¯¹ç›‘æ§äº†è§£æ¯”è¾ƒå°‘çš„èƒ–å‹ï¼Œç†è§£èµ·æ¥ç•¥å¾®ä¼šæœ‰ä¸€ç‚¹æ‡µé€¼ã€‚ç®€å•çš„æ¥è¯´ï¼ŒSpring Boot Actuator æä¾› HTTP API æ¥å£ï¼Œè¿”å›åº”ç”¨çš„å®¡è®¡ï¼ˆauditingï¼‰ã€å¥åº·çŠ¶å†µï¼ˆhealthï¼‰å’ŒæŒ‡æ ‡ï¼ˆmetricsï¼‰ç­‰æ•°æ®ã€‚

ã€ŒTalk is cheap. Show me the codeã€è®©æˆ‘ä»¬å…ˆæ¥å¿«é€Ÿå…¥é—¨ï¼Œä¸€èµ·æ¥æ„Ÿå—ä¸‹ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) ã€‚

æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬æ¥å¯¹ Actuator åšä¸€ä¸ªå¿«é€Ÿå…¥é—¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯¹å®ƒæœ‰ä¸ªç›´è§‚çš„æ„Ÿå—å’Œè®¤è¯†ã€‚

2.1 å¼•å…¥ä¾èµ–
--------

åœ¨ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/pom.xml) æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.2.2.RELEASE</version>
        <relativePath/> 
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>lab-34-acturator-demo</artifactId>

    <dependencies>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
    </dependencies>

</project>
```

*   å…·ä½“æ¯ä¸ªä¾èµ–çš„ä½œç”¨ï¼Œèƒ–å‹è‡ªå·±è®¤çœŸçœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ‰€æœ‰æ³¨é‡Šå™¢ã€‚
*   å¦å¤–ï¼Œ`spring-boot-starter-web` ä¾èµ–å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†ä¿è¯ Spring Boot åº”ç”¨å¯åŠ¨åæŒç»­è¿è¡Œã€‚

2.2 é…ç½®æ–‡ä»¶
--------

åœ¨ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/src/main/resources/application.yaml) ä¸­ï¼Œæ·»åŠ  Actuator é…ç½®ï¼Œå¦‚ä¸‹ï¼š

```
management:
  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude:
```

*   åœ¨ `management.endpoints.web` é…ç½®é¡¹ï¼Œè®¾ç½® Actuator HTTP é…ç½®é¡¹ï¼Œå¯¹åº” [WebEndpointProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/WebEndpointProperties.java) é…ç½®ç±»ã€‚
*   Spring Boot æä¾›çš„ [WebEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/WebEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° Actuator HTTP ç«¯ç‚¹çš„é…ç½®ã€‚
*   é‡ç‚¹ï¼Œæ³¨æ„çœ‹ä¸‹è‰¿è‰¿åœ¨ `include` å’Œ `exclude` çš„æ³¨é‡Šã€‚å› ä¸º Actuator æä¾›äº†å¤šç§ç«¯ç‚¹ ( [Endpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/endpoint/annotation/Endpoint.java) )ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥å¼€å¯æˆ–å…³é—­ç«¯ç‚¹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½® `include: '*'` ï¼Œå¼€å¯æ‰€æœ‰ Actuator ç«¯ç‚¹ã€‚

2.3 Application
---------------

åˆ›å»º [`Application.java`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/Application.java) ç±»ï¼Œé…ç½® `@SpringBootApplication` æ³¨è§£å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
    
}
```

2.4 ç®€å•æµ‹è¯•
--------

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/health](http://127.0.0.1:8080/actuator/health) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„å¥åº·ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "status": "UP"
}
```

*   è¡¨ç¤ºåº”ç”¨å¤„äº**å¼€å¯**çŠ¶æ€ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/beans](http://127.0.0.1:8080/actuator/beans) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„æ‰€æœ‰ Spring Bean ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/01.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å¯¹ Spring Boot Actuator çš„å¿«é€Ÿå…¥é—¨ã€‚

åœ¨ [`org.springframework.boot.actuate`](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate) åŒ…ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Actuator å·²ç»å’Œ**å¤šä¸ªæ¡†æ¶**è¿›è¡Œé›†æˆï¼Œæä¾›**å†…ç½®ç«¯ç‚¹**ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/02.png)

åœ¨[ã€ŠSpring Boot Actuator: Production-ready Featuresã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints)æ–‡æ¡£ä¸­ï¼Œå®˜æ–¹åˆ—ä¸¾æ•´ç†ç«¯ç‚¹å¦‚ä¸‹è¡¨æ ¼ï¼š

<table><thead><tr><th>ID</th><th>Description</th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>Exposes audit events information for the current application. Requires an <code>AuditEventRepository</code> bean.</td></tr><tr><td><code>beans</code></td><td>Displays a complete list of all the Spring beans in your application.</td></tr><tr><td><code>caches</code></td><td>Exposes available caches.</td></tr><tr><td><code>conditions</code></td><td>Shows the conditions that were evaluated on configuration and auto-configuration classes and the reasons why they did or did not match.</td></tr><tr><td><code>configprops</code></td><td>Displays a collated list of all <code>@ConfigurationProperties</code>.</td></tr><tr><td><code>env</code></td><td>Exposes properties from Springâ€™s <code>ConfigurableEnvironment</code>.</td></tr><tr><td><code>flyway</code></td><td>Shows any Flyway database migrations that have been applied. Requires one or more <code>Flyway</code> beans.</td></tr><tr><td><code>health</code></td><td>Shows application health information.</td></tr><tr><td><code>httptrace</code></td><td>Displays HTTP trace information (by default, the last 100 HTTP request-response exchanges). Requires an <code>HttpTraceRepository</code> bean.</td></tr><tr><td><code>info</code></td><td>Displays arbitrary application info.</td></tr><tr><td><code>integrationgraph</code></td><td>Shows the Spring Integration graph. Requires a dependency on <code>spring-integration-core</code>.</td></tr><tr><td><code>loggers</code></td><td>Shows and modifies the configuration of loggers in the application.</td></tr><tr><td><code>liquibase</code></td><td>Shows any Liquibase database migrations that have been applied. Requires one or more <code>Liquibase</code> beans.</td></tr><tr><td><code>metrics</code></td><td>Shows â€˜metricsâ€™ information for the current application.</td></tr><tr><td><code>mappings</code></td><td>Displays a collated list of all <code>@RequestMapping</code> paths.</td></tr><tr><td><code>scheduledtasks</code></td><td>Displays the scheduled tasks in your application.</td></tr><tr><td><code>sessions</code></td><td>Allows retrieval and deletion of user sessions from a Spring Session-backed session store. Requires a Servlet-based web application using Spring Session.</td></tr><tr><td><code>shutdown</code></td><td>Lets the application be gracefully shutdown. Disabled by default.</td></tr><tr><td><code>threaddump</code></td><td>Performs a thread dump.</td></tr></tbody></table>

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±é€ä¸ªç«¯ç‚¹æ¥ç…ç…ï¼ŒåŠ æ·±ç†è§£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-health](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-health/) ã€‚

`health` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/health` æ¥å£ï¼Œå¯¹åº” [HealthEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„å¥åº·çŠ¶æ€ã€‚`health` ç«¯ç‚¹é€šè¿‡å¥åº·æŒ‡ç¤ºå™¨ [HealthIndicator](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java) ï¼Œè·å–ä¸åŒçš„èµ„æºçš„å¥åº·ä¿¡æ¯ã€‚Actuator å†…ç½®äº†å¤šä¸ª HealthIndicator å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/03.jpg)

*   [DiskSpaceHealthIndicator](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java) ï¼ŒåŸºäºç£ç›˜ç©ºé—´çš„ HealthIndicator å®ç°ç±»ã€‚é»˜è®¤é…ç½®ä¸‹ï¼Œå‰©ä½™ç£ç›˜ä¸è¶³ 10MB æ—¶ï¼Œåˆ™è®¤ä¸ºä¸å¥åº·ã€‚
*   [PingHealthIndicator](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/PingHealthIndicator.java) ï¼ŒåŸºäº Ping çš„ HealthIndicator å®ç°ç±»ã€‚å› ä¸ºèƒ½è®¿é—®ä¸Š `GET /actuator/health` æ¥å£ï¼Œè¯´æ˜å°±æ˜¯ Ping çš„é€šï¼Œæ‰€ä»¥åªè¿”å›å¥åº·ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° HealthIndicator æ¥å£ï¼Œè‡ªå®šä¹‰è‡ªå·±çš„å¥åº·æŒ‡ç¤ºå™¨ã€‚

åœ¨ `health` ç«¯ç‚¹ä¸­ï¼Œä¸€å®šå®šä¹‰äº†å››ç§ [Status](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java) çŠ¶æ€ï¼š

*   `UP` ï¼šå¯ç”¨ã€‚
*   `DOWN` ï¼šä¸å¯ç”¨ã€‚
*   `OUT_OF_SERVICE` ï¼šæš‚ä¸æä¾›æœåŠ¡ï¼Œä¸€èˆ¬æ˜¯å¼€å‘è€…ä¸»åŠ¨è®¾ç½®ã€‚å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§ â€œ**ç‰¹æ®Š**â€ çš„ä¸å¯ç”¨ã€‚
*   `UNKNOWN` ï¼šæœªçŸ¥çŠ¶æ€ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ `health` ç«¯ç‚¹çš„ç¤ºä¾‹ï¼ŒåŒæ—¶ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ HealthIndicator å®ç°ç±»ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-health](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-health/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

4.1 é…ç½®æ–‡ä»¶
--------

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-health/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  `health` ç«¯ç‚¹çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    health:
      enabled: true 
      show-details: ALWAYS 
      status:
        http-mapping: 
          DOWN: 503
        order: DOWN, OUT_OF_SERVICE, UP, UNKNOWN 
  health:
    
    diskspace:
      enabled: true 
      path: . 
      threshold: 
  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude:
```

é¢å¤–å¢åŠ  `management.endpoint.health` é…ç½®é¡¹ï¼Œè®¾ç½® `health` ç«¯ç‚¹çš„é…ç½®é¡¹ï¼Œå¯¹åº” [HealthProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/health/HealthProperties.java) é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [HealthEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/health/HealthEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° `health` ç«¯ç‚¹çš„é…ç½®ã€‚
    
*   `enabled` ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚è™½ç„¶æˆ‘ä»¬é€šè¿‡ `management.endpoints.web.web.exposure.include = *` é…ç½®ï¼Œå¼€æ”¾æ‰€æœ‰ç«¯ç‚¹ï¼Œä½†æ˜¯å®ƒä»…ä»…æ˜¯å¼€æ”¾ `health` ç«¯ç‚¹çš„ **HTTP** ï¼Œå®é™…è¿˜æ˜¯éœ€è¦é…ç½® `enabled = true` æ¥å¼€å¯ `health` ç«¯ç‚¹çš„**åŠŸèƒ½**ã€‚ä¸è¿‡ï¼Œå› ä¸º `enabled` é»˜è®¤ä¸º `true` ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ä¸»åŠ¨å»é…ç½®ã€‚
    
*   `show-details` ï¼šä½•æ—¶æ˜¾ç¤ºå®Œæ•´çš„å¥åº·ä¿¡æ¯ã€‚å®ƒä¸€å…±æœ‰ä¸‰ç§é€‰æ‹©é¡¹ [HealthProperties.Show](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/health/HealthProperties.java)ï¼š
    
    *   `NEVER` ï¼š**é»˜è®¤å€¼**ï¼Œéƒ½ä¸å±•ç¤ºã€‚è¿™æ ·ï¼Œ`health` ç«¯ç‚¹åªä¼šè¿”å›åº”ç”¨çš„**æ±‡æ€»**å¥åº·çŠ¶æ€ï¼Œä¸ä¼šåŒ…å«å®Œæ•´çš„å¥åº·ä¿¡æ¯ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨[ã€Œ2.4 ç®€å•æµ‹è¯•ã€](#)æ‰€çœ‹åˆ°çš„ã€‚
    *   `ALWAYS` ï¼šæ€»æ˜¯å±•ç¤ºã€‚æœ¬ç¤ºä¾‹æˆ‘ä»¬é‡‡ç”¨è¯¥é€‰æ‹©é¡¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ª HealthIndicator æä¾›çš„å¥åº·ä¿¡æ¯ã€‚
    *   `WHEN_AUTHORIZED` ï¼šç»è¿‡æˆæƒçš„ç”¨æˆ·ï¼Œå¯çœ‹åˆ°å®Œæ•´çš„å¥åº·ä¿¡æ¯ã€‚
*   `status.http-mapping` ï¼šè®¾ç½®ä¸åŒå¥åº·çŠ¶æ€ (`status`) å¯¹åº”çš„å“åº”çŠ¶æ€ç ã€‚ä¾‹å¦‚è¯´ï¼Œåœ¨æˆ‘ä»¬é…åˆ [Tengine](https://tengine.taobao.org/) çš„ [å¥åº·æ£€æŸ¥åŠŸèƒ½](https://tengine.taobao.org/document_cn/http_upstream_check_cn.html) æ—¶ï¼Œé€šè¿‡æ£€æµ‹ `health` ç«¯ç‚¹ï¼Œå‘ç°åº”ç”¨çš„å¥åº·çŠ¶æ€ä¸º `DOWN` æ—¶ï¼Œè¿›è¡Œæ‘˜é™¤ã€‚ä¸è¿‡å› ä¸º Tengine åªèƒ½åŸºäº**å“åº”çš„çŠ¶æ€ç **åˆ¤æ–­åº”ç”¨æ˜¯å¦å¥åº·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°† `DOWN` çŠ¶æ€çš„åº”ç”¨ï¼Œ`health` ç«¯ç‚¹çš„è¿”å› 503 èµ„æºä¸å¯ç”¨ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ `status.http-mapping` æ¥é…ç½®äº†ã€‚
    
    > è‰¿è‰¿åæ¥æŸ¥è¯¢äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ`UP` å’Œ `UNKNOWN` çŠ¶æ€è¿”å› 200 å“åº”ç ï¼Œ`DOWN` å’Œ `OUT_OF_SERVICE` è¿”å› 503 çŠ¶æ€ç  (SERVICE_UNAVAILABLE) ã€‚
    > 
    > æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯æ— éœ€é…ç½®çš„ã€‚
    
*   `status.order` ï¼šå¥åº·çŠ¶æ€æ’åºå€¼ã€‚è¿™é‡Œæˆ‘ä»¬é…ç½®çš„ `DOWN, OUT_OF_SERVICE, UP, UNKNOWN` å°±æ˜¯**é»˜è®¤**çš„æ’åºã€‚å› ä¸ºå¤šä¸ª HealthIndicator å¯èƒ½ä¼šè¿”å›ä¸åŒçš„ç»“æœï¼Œæœ€ç»ˆéœ€è¦**æ±‡æ€»**æˆä¸€ä¸ªå¥åº·çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œä»¥ç»“æœä¸­æŒ‰ç…§ `status.order` æ¥æ’åºä¹‹åï¼Œæ’åœ¨ç¬¬ä¸€ä¸ªçš„ç»“æœä¸º**æ±‡æ€»**çŠ¶æ€ã€‚å¦‚æœæœ‰ç‚¹æ‡µé€¼çš„èƒ–å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[ã€Œ4.3 ç®€å•æµ‹è¯•ã€](#)ä¸­ï¼Œè¿›ä¸€æ­¥ç†è§£ã€‚
    
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.endpoint.health` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚
    

é¢å¤–å¢åŠ  `management.health.diskspace` é…ç½®é¡¹ï¼Œè®¾ç½® DiskSpaceHealthIndicator çš„é…ç½®é¡¹ï¼Œå¯¹åº” [DiskSpaceHealthIndicatorProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/system/DiskSpaceHealthIndicatorProperties.java) é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [DiskSpaceHealthContributorAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/system/DiskSpaceHealthContributorAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° DiskSpaceHealthIndicator çš„é…ç½®ã€‚
*   `enabled` å±æ€§ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   `path` å±æ€§ï¼šç›®å½•ã€‚é»˜è®¤ä¸º `.` å½“å‰ç›®å½•ã€‚
*   `threshold` å±æ€§ï¼šå‰©ä½™ç©ºé—´çš„é˜€å€¼ã€‚é»˜è®¤ä¸º 10M ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.health.diskspace` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

4.2 DemoHealthIndicator
-----------------------

åœ¨æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª HealthIndicator å®ç°ç±»ã€‚åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.actuate`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-health/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/actuate/) åŒ…ä¸‹ï¼Œåˆ›å»º [DemoHealthIndicator](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-health/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/actuate/DemoHealthIndicator.java) ç±»ï¼Œç»§æ‰¿ [AbstractHealthIndicator](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/AbstractHealthIndicator.java) æŠ½è±¡ç±»ï¼Œç¤ºä¾‹ HealthIndicator ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Component
public class DemoHealthIndicator extends AbstractHealthIndicator {

    @Override
    protected void doHealthCheck(Health.Builder builder) {
        
        boolean success = checkSuccess();

        
        if (success) {
            builder.up().build();
            return;
        }

        
        builder.down().withDetail("msg", "æˆ‘å°±æ˜¯åšä¸ªç¤ºä¾‹è€Œå·²");
    }

    private boolean checkSuccess() {
        return false;
    }

}
```

*   AbstractHealthIndicator æ˜¯ç”± Actuator æä¾›çš„æŠ½è±¡åŸºç±»ï¼Œæ–¹ä¾¿å®ç° HealthIndicator ï¼Œæˆ‘ä»¬ä»…éœ€å®ç° `#doHealthCheck(Health.Builder builder)` æ–¹æ³•å³å¯ã€‚å½“ç„¶ï¼Œå†…ç½®çš„ HealthIndicator ï¼Œä¹Ÿæ˜¯ç»§æ‰¿ AbstractHealthIndicator æŠ½è±¡ç±»ã€‚
*   åœ¨ç±»ä¸Šï¼Œæ·»åŠ  `@Component` æ³¨è§£ï¼Œä¿è¯èƒ½å¤Ÿè¢« `health` ç«¯ç‚¹è·å–åˆ°ã€‚ğŸ˜ˆ ä¸ç„¶ï¼Œå’±ä¸å°±ç™½è‡ªå®šä¹‰å®ç° HealthIndicator äº†å˜›ã€‚
*   `<1>` å¤„ï¼Œè°ƒç”¨ `#checkSuccess()` æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦å¥åº·ã€‚è¿™é‡Œå› ä¸ºæ˜¯ç¤ºä¾‹ï¼Œæˆ‘ä»¬å…ˆç›´æ¥è¿”å› `false` ã€‚
*   `<2>` å¤„ï¼Œå¦‚æœå¥åº·ï¼Œåˆ™è°ƒç”¨ [`Health.Builder#up()`](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Health.java#L288-L294) æ–¹æ³•ï¼Œæ ‡è®°å¥åº·çŠ¶æ€ä¸º `Status.UP` ã€‚
*   `<3>` å¤„ï¼Œå¦‚æœä¸å¥åº·ï¼Œåˆ™è°ƒç”¨ [`Health.Builder#down()`](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Health.java#L237-L248) æ–¹æ³•ï¼Œæ ‡è®°å¥åº·çŠ¶æ€ä¸º `Status.DOWN` ã€‚åŒæ—¶ï¼Œè°ƒç”¨ [`Health.Builder#withDetail(String key, Object value)`](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Health.java#L237-L248) æ–¹æ³•ï¼Œæ·»åŠ ä¸€ç»„é”®å€¼å¯¹ï¼Œè®¾ç½®åˆ°è¯¦ç»†ä¿¡æ¯ä¸­ã€‚

4.3 ç®€å•æµ‹è¯•
--------

**â‘  ç¬¬ä¸€è½®**

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/health](http://127.0.0.1:8080/actuator/health) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„å¥åº·ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
  "status": "DOWN",
  "components": {
    "demo": {
      "status": "DOWN",
      "details": {
        "msg": "æˆ‘å°±æ˜¯åšä¸ªç¤ºä¾‹è€Œå·²"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 499963174912,
        "free": 173201915904,
        "threshold": 10485760
      }
    },
    "ping": {
      "status": "UP"
    }
  }
}
```

å› ä¸ºæˆ‘ä»¬é…ç½®äº† `management.endpoint.health.show-details=ALWAYS` ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°å®Œæ•´çš„å¥åº·ä¿¡æ¯ã€‚è¿™é‡Œï¼Œå±•ç¤ºäº† 3 ä¸ª HealthIndicator çš„å¥åº·çŠ¶æ€çš„ç»“æœï¼š

*   `"demo"` å¯¹åº” DemoHealthIndicator ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ `#checkSuccess()` æ–¹æ³•ä¸­å¼ºåˆ¶è¿”å›äº† `false` ï¼Œæ‰€ä»¥è¿”å›çš„å¥åº·çŠ¶æ€å°±æ˜¯ `DOWN` ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨ `details` ä¸­çœ‹åˆ°äº†æˆ‘ä»¬è®¾ç½®çš„ `msg` é”®å€¼å¯¹ã€‚
*   `"diskSpace"` å¯¹åº” DiskSpaceHealthIndicator ï¼Œè¿”å›çš„å¥åº·çŠ¶æ€çš„ç»“æœæ˜¯ `UP` ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨ `details` ä¸­å¯ä»¥çœ‹åˆ° DiskSpaceHealthIndicator è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚
*   `"ping"` å¯¹åº” PingHealthIndicator ï¼Œè¿”å›çš„å¥åº·çŠ¶æ€çš„ç»“æœæ˜¯ `UP` ã€‚å› ä¸º DiskSpaceHealthIndicator æ²¡æœ‰è®¾ç½®è¯¦ç»†ä¿¡æ¯ï¼Œæ‰€ä»¥çœ‹ä¸åˆ° `details` ã€‚

æœ€ç»ˆè¿”å›çš„å¥åº·çŠ¶æ€æ˜¯ `DOWN` ã€‚æˆ‘ä»¬å›è¿‡å¤´çœ‹ä¸‹æˆ‘ä»¬åœ¨ `management.endpoint.health.status.order` çš„è®²è§£ã€‚

*   è¿™é‡Œä¸€å…±è¿”å›äº† `[UP, UP, DOWN]` ä¸‰ä¸ªå¥åº·çŠ¶æ€ï¼ŒæŒ‰ç…§ `management.endpoint.health.status.order` æ’åºä¹‹åï¼Œç»“æœæ˜¯ `[DOWN, UP, UP]` ã€‚
*   å–æ’åºåçš„å¥åº·çŠ¶æ€ç»“æœçš„**ç¬¬ä¸€ä¸ª** `DOWN` ï¼Œæˆä¸ºæœ€ç»ˆçš„**æ±‡æ€»**çŠ¶æ€è¿›è¡Œè¿”å›ã€‚

ä¸Šè¿°çš„é€»è¾‘ï¼Œé€šè¿‡ [SimpleStatusAggregator](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/SimpleStatusAggregator.java) çš„ `#getAggregateStatus(Set<Status> statuses)` æ¥èšåˆã€‚ä»£ç å¦‚ä¸‹ï¼š

```
private final List<String> order;

private final Comparator<Status> comparator = new StatusComparator();

@Override
public Status getAggregateStatus(Set<Status> statuses) {
	return statuses.stream()
	.filter(this::contains) 
	.sorted(this.comparator) 
	.findFirst() 
	.orElse(Status.UNKNOWN); 
}
```

*   `<1>` å¤„ï¼Œè¿‡æ»¤æ‰å¤šä¸ª HealthIndicator å¥åº·çŠ¶æ€é›†åˆä¸­ï¼Œä¸åŒ…å«åœ¨çŠ¶æ€æ’åºæ•°ç»„ `order` çš„çŠ¶æ€ã€‚
*   `<2>` å¤„ï¼ŒæŒ‰ç…§ `comparator` è¿›è¡Œæ’åºã€‚è¯¥ StatusComparator æ’åºå™¨ï¼ŒåŸºäºçŠ¶æ€æ’åºæ•°ç»„ `order` è¿›è¡Œå‡åºã€‚
*   `<3>` å¤„ï¼Œè·å¾—æ’åºç»“æœä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚
*   `<4>` å¤„ï¼Œå¦‚æœå› ä¸º `<1>` å¤„è¿‡æ»¤åçš„ç»“æœé›†åˆä¸ºç©ºï¼Œåˆ™è¿”å› `Status.UNKNOWN` çŠ¶æ€ã€‚
*   ğŸ˜ˆ è¿™é‡Œç®—æ˜¯ Java8 Stream API çš„ç»å…¸ç”¨æ³•ï¼Œèƒ–å‹åœ¨é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥å°è¯•ä¸€æ³¢ã€‚

**â‘  ç¬¬äºŒè½®**

ä¿®æ”¹ DemoHealthIndicator çš„ `#checkSuccess()` æ–¹æ³•ï¼Œå¼ºåˆ¶è¿”å› `true` ã€‚ç„¶åï¼Œé‡å¯ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/health](http://127.0.0.1:8080/actuator/health) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„å¥åº·ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
  "status": "UP",
  "components": {
    "demo": {
      "status": "UP"
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 499963174912,
        "free": 174055534592,
        "threshold": 10485760
      }
    },
    "ping": {
      "status": "UP"
    }
  }
}
```

å› ä¸º 3 ä¸ª HealthIndicator çš„å¥åº·çŠ¶æ€çš„ç»“æœéƒ½æ˜¯ `UP` ï¼Œæ‰€ä»¥æœ€ç»ˆè¿”å›çš„å¥åº·çŠ¶æ€ä¹Ÿä¸º `UP` ã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `health` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 2.8. Health Informationã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-health)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-info](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/) ã€‚

`info` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/info` æ¥å£ï¼Œå¯¹åº” [InfoEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„ä¿¡æ¯ã€‚`info` ç«¯ç‚¹é€šè¿‡ä¿¡æ¯è´¡çŒ®è€… [InfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java) ï¼Œè·å–ä¸åŒçš„æ¥æºçš„ä¿¡æ¯ã€‚Actuator å†…ç½®äº†å¤šä¸ª InfoContributor å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/04.png)

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° InfoContributor æ¥å£ï¼Œè‡ªå®šä¹‰è‡ªå·±çš„ä¿¡æ¯è´¡çŒ®è€…ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ `info` ç«¯ç‚¹çš„ç¤ºä¾‹ï¼ŒåŒæ—¶ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ InfoContributor å®ç°ç±»ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-info](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

æ³¨æ„ï¼Œä¸‹é¢çš„æ¯ä¸€ä¸ªå°èŠ‚ï¼Œéƒ½å¯¹åº”ä¸€ä¸ª InfoContributor çš„ä½¿ç”¨ç¤ºä¾‹ã€‚

5.1 EnvironmentInfoContributor
------------------------------

[EnvironmentInfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java)ï¼Œæä¾› æ¥è‡ª `info` é…ç½®ä¸‹çš„åº”ç”¨ä¿¡æ¯ã€‚

### 5.1.1 é…ç½®æ–‡ä»¶

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  EnvironmentInfoContributor çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    info:
      enabled: true 
  info:
    
    env:
      enabled: true

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude: 


info:
  app:
    java:
      source: @java.version@
      target: @java.version@
    encoding: UTF-8
    version: @project.version@
```

é¢å¤–å¢åŠ  `management.endpoint.info` é…ç½®é¡¹ï¼Œè®¾ç½® `info` ç«¯ç‚¹çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [InfoEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° `info` ç«¯ç‚¹çš„é…ç½®ã€‚
*   `enabled` ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.endpoint.info` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

é¢å¤–å¢åŠ  `management.info.env` é…ç½®é¡¹ï¼Œè®¾ç½® EnvironmentInfoContributor çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [InfoContributorAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoContributorAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° EnvironmentInfoContributor çš„é…ç½®ã€‚
*   `enabled` å±æ€§ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.info.env` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

é¢å¤–å¢åŠ  `info` é…ç½®é¡¹ï¼Œè®¾ç½®åº”ç”¨çš„ä¿¡æ¯ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `"@...@"` æ¥è¯»å– Maven çš„å±æ€§ã€‚ä¾‹å¦‚è¯´ï¼š`@java.version@` è¯»å– Maven æ„å»ºé¡¹ç›®çš„ Java ç‰ˆæœ¬ã€‚

### 5.1.2 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
  "app": {
    "java": {
      "source": "1.8.0_144",
      "target": "1.8.0_144"
    },
    "encoding": "UTF-8",
    "version": "2.2.2.RELEASE"
  }
}
```

*   `"app"` å“åº”ç»“æœï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ `info` é…ç½®é¡¹ä¸‹æ·»åŠ çš„ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬æ‰“å¼€æ„å»ºç»“æ„ `target/classes/application.yaml` é…ç½®æ–‡ä»¶ï¼Œä¼šå‘ç° `info` é…ç½®é¡¹ï¼Œåœ¨æ„å»ºæ—¶å€™ï¼Œå·²ç»è¢«é‡å†™ã€‚è¯¥éƒ¨åˆ†é…ç½®ä¸‹ï¼š

```
info:
  app:
    java:
      source: 1.8.0_144
      target: 1.8.0_144
    encoding: UTF-8
    version: 2.2.2.RELEASE
```

5.2 BuildInfoContributor
------------------------

[BuildInfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java)ï¼Œæä¾›æ¥è‡ªæ„å»ºä¿¡æ¯ `META-INF/build-info.properties` çš„åº”ç”¨ä¿¡æ¯ã€‚

### 5.2.1 é…ç½®æ–‡ä»¶

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  BuildInfoContributor çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    info:
      enabled: true 
  info:
    
    env:
      enabled: true
    
    build:
      enabled: true

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude: 


info:
  app:
    java:
      source: @java.version@
      target: @java.version@
    encoding: UTF-8
    version: @project.version@
```

é¢å¤–å¢åŠ  `management.info.build` é…ç½®é¡¹ï¼Œè®¾ç½® BuildInfoContributor çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [InfoContributorAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoContributorAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° BuildInfoContributor çš„é…ç½®ã€‚
*   `enabled` å±æ€§ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.info.build` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

### 5.2.2 æ„å»ºä¿¡æ¯

æ„å»ºä¿¡æ¯ `META-INF/build-info.properties` ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Boot æä¾›çš„ [spring-boot-maven-plugin](https://docs.spring.io/spring-boot/docs/current/maven-plugin/usage.html) æ’ä»¶ï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆã€‚

åœ¨ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/pom.xml) æ–‡ä»¶ä¸­ï¼Œå¼•å…¥è¯¥æ’ä»¶ã€‚å¢åŠ éƒ¨åˆ†å¦‚ä¸‹ï¼š

```
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>build-info</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

æ‰‹åŠ¨æ‰§è¡Œ `spring-boot-maven-plugin` æ’ä»¶çš„ `build-info` ä»»åŠ¡ã€‚æ“ä½œå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/05.png)

æ‰§è¡Œå®Œæˆåï¼Œæ‰“å¼€æ„å»ºç»“æ„ `target/classes/` ç›®å½•ï¼Œä¼šå‘ç° `META-INF/build-info.properties` è¢«è‡ªåŠ¨ç”Ÿæˆã€‚å†…å®¹å¦‚ä¸‹ï¼š

```
build.artifact=lab-34-acturator-demo-info
build.group=org.springframework.boot
build.name=lab-34-acturator-demo-info
build.time=2019-12-21T03\:37\:23.860Z
build.version=2.2.2.RELEASE
```

*   ç”Ÿæˆçš„æ„å»ºä¿¡æ¯ï¼Œå¯¹åº” [BuildProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/info/BuildProperties.java) é…ç½®ç±»ã€‚

### 5.2.3 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    // ... çœç•¥å…¶å®ƒçš„
    
    "build": {
        "version": "2.2.2.RELEASE",
        "artifact": "lab-34-acturator-demo-info",
        "name": "lab-34-acturator-demo-info",
        "group": "org.springframework.boot",
        "time": "2019-12-21T03:49:19.060Z"
    }
}
```

*   `"build"` å“åº”ç»“æœï¼Œå°±æ˜¯ `META-INF/build-info.properties` æ„å»ºä¿¡æ¯ã€‚

5.3 GitInfoContributor
----------------------

[GitInfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java)ï¼Œæä¾›è‡ªæ¥ Git çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚

### 5.3.1 é…ç½®æ–‡ä»¶

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  GitInfoContributor çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    info:
      enabled: true 
  info:
    
    env:
      enabled: true
    
    build:
      enabled: true
    
    git:
      enabled: true
      mode: SIMPLE 

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude: 


info:
  app:
    java:
      source: @java.version@
      target: @java.version@
    encoding: UTF-8
    version: @project.version@
```

é¢å¤–å¢åŠ  `management.info.git` é…ç½®é¡¹ï¼Œè®¾ç½® GitInfoContributor çš„é…ç½®é¡¹ï¼Œå¯¹åº” [InfoContributorProperties.Git](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoContributorProperties.java#L37-L52) é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [InfoContributorAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoContributorAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° BuildInfoContributor çš„é…ç½®ã€‚
*   `enabled` å±æ€§ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   `mode` å±æ€§ï¼šGit ä¿¡æ¯å±•ç¤ºæ¨¡å¼ã€‚å…·ä½“çš„è§£é‡Šï¼Œçœ‹ä¸‹è‰¿è‰¿åœ¨é…ç½®ä¸Šçš„æ³¨é‡Šã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨ `SIMPLE` æ¨¡å¼ï¼Œåªå±•ç¤ºç²¾ç®€çš„ Git ç‰ˆæœ¬ä¿¡æ¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.info.git` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

### 5.3.2 Git ç‰ˆæœ¬ä¿¡æ¯

Git ç‰ˆæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [git-commit-id-plugin](https://github.com/git-commit-id/maven-git-commit-id-plugin) æ’ä»¶ï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆã€‚

åœ¨ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/pom.xml) æ–‡ä»¶ä¸­ï¼Œå¼•å…¥è¯¥æ’ä»¶ã€‚å¢åŠ éƒ¨åˆ†å¦‚ä¸‹ï¼š

```
<plugin>
    <groupId>pl.project13.maven</groupId>
    <artifactId>git-commit-id-plugin</artifactId>
    <executions>
        <execution>
            <goals>
                <goal>revision</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

æ‰‹åŠ¨æ‰§è¡Œ `git-commit-id-plugin` æ’ä»¶çš„ `git-commit-id:revision` ä»»åŠ¡ã€‚æ“ä½œå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/06.png)

æ‰§è¡Œå®Œæˆåï¼Œæ‰“å¼€æ„å»ºç»“æ„ `target/classes/` ç›®å½•ï¼Œä¼šå‘ç° `git.properties` è¢«è‡ªåŠ¨ç”Ÿæˆã€‚å†…å®¹å¦‚ä¸‹ï¼š

```
#Generated by Git-Commit-Id-Plugin
#Sat Dec 21 12:30:20 CST 2019
git.branch=master
git.build.host=MacBook-Pro-8
git.build.time=2019-12-21T12\:30\:20+0800
git.build.user.email=
git.build.user.name=YunaiV
git.build.version=2.2.2.RELEASE
git.closest.tag.commit.count=
git.closest.tag.name=
git.commit.id=ff43301283d09b78d531857d4e22c31d060e8f45
git.commit.id.abbrev=ff43301
git.commit.id.describe=ff43301-dirty
git.commit.id.describe-short=ff43301-dirty
git.commit.message.full=\u589E\u52A0 actuate \u793A\u4F8B
git.commit.message.short=\u589E\u52A0 actuate \u793A\u4F8B
git.commit.time=2019-12-21T10\:28\:25+0800
git.commit.user.email=
git.commit.user.name=YunaiV
git.dirty=true
git.local.branch.ahead=NO_REMOTE
git.local.branch.behind=NO_REMOTE
git.remote.origin.url=https\://github.com/YunaiV/SpringBoot-Labs.git
git.tags=
git.total.commit.count=197
```

*   ç”Ÿæˆçš„ Git ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯¹åº” [GitProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/info/GitProperties.java) é…ç½®ç±»ã€‚

### 5.3.3 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    // ... çœç•¥å…¶å®ƒçš„
    
    "git": {
        "commit": {
            "time": "2019-12-21T02:28:25Z",
            "id": "ff43301"
        },
        "branch": "master"
    }
}
```

*   `"git"` å“åº”ç»“æœï¼Œå°±æ˜¯ `git.properties` ç‰ˆæœ¬ä¿¡æ¯ã€‚å› ä¸ºæ˜¯ `SIMPLE` æ¨¡å¼ï¼Œæ‰€ä»¥åªå±•ç¤ºéƒ¨åˆ† Git ç‰ˆæœ¬ä¿¡æ¯ã€‚

5.4 SimpleInfoContributor
-------------------------

[SimpleInfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/SimpleInfoContributor.java)ï¼Œç”¨äºæä¾›**ä¸€ä¸ª**åº”ç”¨çš„ä¿¡æ¯ã€‚

### 5.4.1 ActuateConfig

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.config`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/) åŒ…ä¸‹ï¼Œåˆ›å»º [ActuateConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/ActuateConfig.java) é…ç½®ç±»ï¼Œé…ç½®ä¸€ä¸ª SimpleInfoContributor Beanã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Configuration
public class ActuateConfig {

    @Bean
    public InfoContributor exampleInfo() {
        return new SimpleInfoContributor("example",
                Collections.singletonMap("key", "value"));
    }

}
```

*   æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±çœ‹ä¸‹å°±æ‡‚ã€‚

### 5.4.2 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    // ... çœç•¥å…¶å®ƒçš„

    "example": {
        "key": "value"
    }
}
```

5.5 MapInfoContributor
----------------------

[MapInfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/MapInfoContributor.java)ï¼Œç”¨äºæä¾› map ç»“æ„çš„åº”ç”¨ä¿¡æ¯ã€‚

ä½¿ç”¨æ–¹å¼å’Œ[ã€Œ5.4 SimpleInfoContributorã€](#)ç±»ä¼¼ï¼Œå°±ä¸é‡å¤èµ˜è¿°ã€‚

5.6 DemoInfoContributor
-----------------------

åœ¨æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª InfoContributor å®ç°ç±»ã€‚åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.demo`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/demo/) åŒ…ä¸‹ï¼Œåˆ›å»º [DemoInfoContributor](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-info/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/demo/DemoInfoContributor.java) ç±»ï¼Œå®ç° [InfoContributor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java) æ¥å£ï¼Œç¤ºä¾‹ InfoContributor ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Component
public class DemoInfoContributor implements InfoContributor {

    @Override
    public void contribute(Info.Builder builder) {
        builder.withDetail("demo",
                Collections.singletonMap("key", "value"));
    }

}
```

*   åœ¨ç±»ä¸Šï¼Œæ·»åŠ  `@Component` æ³¨è§£ï¼Œä¿è¯èƒ½å¤Ÿè¢« `info` ç«¯ç‚¹è·å–åˆ°ã€‚ğŸ˜ˆ ä¸ç„¶ï¼Œå’±ä¸å°±ç™½è‡ªå®šä¹‰å®ç° InfoContributor äº†å˜›ã€‚
*   æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±çœ‹ä¸‹å°±æ‡‚ã€‚æ•ˆæœä¸Šï¼Œå’Œ[ã€Œ5.4 SimpleInfoContributorã€](#)æ˜¯ä¸€è‡´çš„ã€‚

### 5.6.1 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    // ... çœç•¥å…¶å®ƒçš„

    "demo": {
        "key": "value"
    }
}
```

> **é‡è¦**ï¼šæ›´å¤šå…³äº `info` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 2.9. Application Informationã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-application-info)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/) ã€‚

`metrics` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/metrics` å’Œ `GET /actuator/metrics/{name}` æ¥å£ï¼Œå¯¹åº” [MetricsEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/MetricsEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„æŒ‡æ ‡ (Metrics) ä¿¡æ¯ã€‚ä¾‹å¦‚è¯´ï¼ŒJVM å†…å­˜ä¿¡æ¯ã€JVM GC ä¿¡æ¯ã€çº¿ç¨‹ä¿¡æ¯ç­‰ç­‰ã€‚

é€šè¿‡ä¸æ–­è·å–é‡‡é›†åº”ç”¨çš„æŒ‡æ ‡ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨æ•°æ®åˆ°å­˜å‚¨å™¨ä¸­ã€‚ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¯¥æ•°æ®å½¢æˆç›¸åº”çš„ç›‘æ§æŠ¥è¡¨ã€‚å¦‚ä¸‹æ˜¯åŸºäº [Prometheus](https://github.com/prometheus/prometheus) + [Grafana](https://grafana.com/) å®ç°çš„ JVM æŠ¥è¡¨çš„ç¤ºä¾‹ï¼š

> FROM [https://grafana.com/grafana/dashboards/4701](https://grafana.com/grafana/dashboards/4701)
> 
> ![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/07.png)

åŒæ—¶ï¼Œåœ¨åº”ç”¨çš„æŒ‡æ ‡åˆ°è¾¾æŒ‡å®šé˜€å€¼æ—¶ï¼Œç›‘æ§ç³»ç»Ÿå‘å‡ºå‘Šè­¦ï¼Œä»è€Œè®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿä»‹å…¥ï¼Œè¿›è¡Œé—®é¢˜çš„æ’æŸ¥ã€‚å¦‚ä¸‹æ˜¯é˜¿é‡Œäº‘çš„ç›‘æ§ç³»ç»Ÿåœ¨é’‰é’‰ä¸Šçš„æç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/08.png)

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ `metrics` ç«¯ç‚¹çš„ç¤ºä¾‹ï¼ŒåŒæ—¶ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡æ ‡çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

6.1 å†…ç½®æŒ‡æ ‡
--------

åœ¨ Actuator ä¸­ï¼Œå·²ç»å†…ç½®å¤šä¸ªå¸¸ç”¨æŒ‡æ ‡ï¼Œæ‰€ä»¥åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·ç…ç…ã€‚

### 6.1.1 é…ç½®æ–‡ä»¶

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  `metrics` ç«¯ç‚¹çš„ç›¸å…³é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    metrics:
      enabled: true 
  
  metrics:
    
    enable:
      xxx: false
    
    tags:
      application: demo-application

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude:
```

é¢å¤–å¢åŠ  `management.endpoint.metrics` é…ç½®é¡¹ï¼Œè®¾ç½® `metrics` ç«¯ç‚¹çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [MetricsEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/MetricsEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° `metrics` ç«¯ç‚¹çš„é…ç½®ã€‚
*   `enabled` ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.endpoint.metrics` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

é¢å¤–å¢åŠ  `management.info.metrics` é…ç½®é¡¹ï¼Œè®¾ç½® Metrics çš„å…·ä½“é…ç½®é¡¹ï¼Œå¯¹åº” [MetricsProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/MetricsProperties.java) é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [MetricsAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/MetricsAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° Metrics çš„é…ç½®ã€‚
*   `enabled` å±æ€§ï¼šè®¾ç½®**æŒ‡å®šå‰ç¼€**çš„æŒ‡æ ‡æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤éƒ½ä¸º `true` å¼€å¯ã€‚ä¾‹å¦‚è¯´ï¼Œèƒ–å‹ä¸å¸Œæœ› JVM ç›¸å…³çš„æŒ‡æ ‡è¢«æä¾›æŸ¥å‡ºæ¥ï¼Œåˆ™å¯ä»¥å°†è¿™é‡Œçš„ `xxx` æ”¹æˆ `jvm` å³å¯ã€‚
*   `tags` å±æ€§ï¼šæŒ‡æ ‡çš„**é€šç”¨** Tag æ ‡ç­¾ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªé€šè¿‡ç”¨æ ‡ç­¾é”®ä¸º `application` ï¼Œå€¼ä¸º `demo-application` ã€‚æˆ‘ä»¬æ¥è¯•ç€æƒ³ä¸‹ï¼Œåº”ç”¨ A å’Œåº”ç”¨ B éƒ½æœ‰ç›¸åŒçš„ Metrics åï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦å»åŒºåˆ†å®ƒä»¬ï¼Œåˆ™éœ€è¦é€šè¿‡ç»™ Metrics æ‰“ä¸Šä¸åŒçš„æ ‡ç­¾æ¥åŒºåˆ†ï¼Œè€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹© `application` ä½œä¸ºæ ‡ç­¾ã€‚å¦‚æœèƒ–å‹æœ‰ä½¿ç”¨è¿‡ Prometheus + Grafana æ¥åšç›‘æ§æŠ¥è¡¨ï¼Œä¼šå‘ç°ä¹Ÿæ˜¯æ¨èè¿™ä¹ˆå®è·µçš„ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.info.metrics` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

### 6.1.2 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/metrics](http://127.0.0.1:8080/actuator/metrics) åœ°å€ï¼Œè·å¾—**æŒ‡æ ‡åˆ—è¡¨**ã€‚æ³¨æ„ï¼Œè¿™é‡Œä»…ä»…åªè¿”å›æŒ‡æ ‡çš„**åå­—**ï¼Œä¸è¿”å›æŒ‡æ ‡çš„å…·ä½“**æ•°å€¼**ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "names": [
        // JVM memory
        "jvm.memory.max",
        "jvm.memory.used",
        "jvm.memory.committed",
        // JVM buffer
        "jvm.buffer.count",
        "jvm.buffer.total.capacity",
        "jvm.buffer.memory.used",
        // JVM gc
        "jvm.gc.memory.allocated",
        "jvm.gc.memory.promoted",
        "jvm.gc.max.data.size",
        "jvm.gc.pause",
        "jvm.gc.live.data.size",
        // JVM threads
        "jvm.threads.states",
        "jvm.threads.daemon",
        "jvm.threads.live",
        "jvm.threads.peak",
        // JVM classes
        "jvm.classes.loaded",
        "jvm.classes.unloaded",
        
        // Process
        "process.files.open",
        "process.files.max",
        "process.uptime",
        "process.start.time",
        "process.cpu.usage",
        
        // System
        "system.load.average.1m",
        "system.cpu.count",
        "system.cpu.usage",

        // Logback
        "logback.events",
        
        // Tomcat
        "tomcat.sessions.active.max",
        "tomcat.sessions.active.current",
        "tomcat.sessions.alive.max",
        "tomcat.sessions.created",
        "tomcat.sessions.rejected",
        "tomcat.sessions.expired",
        
        // HTTP
        "http.server.requests"
    ]
}
```

*   è‰¿è‰¿æŠŠæŒ‡æ ‡åšäº†ä¸‹æ¢³ç†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæœ‰ JVMã€Processã€Systemã€Logbackã€Tomcatã€HTTP å¤§ç±»çš„æŒ‡æ ‡ã€‚æ¯ä¸ªæŒ‡æ ‡çš„å«ä¹‰ï¼Œèƒ–å‹å¯ä»¥åç»­æ„Ÿå…´è¶£è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚
*   å¦‚æœèƒ–å‹å¼•å…¥æ•°æ®åº“è¿æ¥æ± ï¼Œåˆ™ä¼šçœ‹åˆ° Datasource ç›¸å…³çš„æŒ‡æ ‡ã€‚

ç»§ç»­ä½¿ç”¨æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/metrics/jvm.memory.max](http://127.0.0.1:8080/actuator/metrics/jvm.memory.max) åœ°å€ï¼Œè·å¾— `jvm.memory.max` æŒ‡æ ‡çš„æ•°å€¼ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "name": "jvm.memory.max",
    "description": "The maximum amount of memory in bytes that can be used for memory management",
    "baseUnit": "bytes",
    "measurements": [
        {
            "statistic": "VALUE",
            "value": 9893314559
        }
    ],
    "availableTags": [
        {
            "tag": "area",
            "values": [
                "heap",
                "nonheap"
            ]
        },
        {
            "tag": "application",
            "values": [
                "demo-application"
            ]
        },
        {
            "tag": "id",
            "values": [
                "Compressed Class Space",
                "PS Old Gen",
                "PS Survivor Space",
                "Metaspace",
                "PS Eden Space",
                "Code Cache"
            ]
        }
    ]
}
```

*   å¯¹åº” [MetricsEndpoint.MetricResponse](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/MetricsEndpoint.java#L181-L249) å“åº”ç±»ã€‚
*   `name` ï¼šæŒ‡æ ‡çš„åå­—ã€‚
*   `description` ï¼šæŒ‡æ ‡çš„æè¿°ã€‚
*   `measurements` ï¼šæŒ‡æ ‡çš„æµ‹é‡æ•°å€¼ã€‚
*   `baseUnit` ï¼šæŒ‡æ ‡çš„å•ä½ã€‚
*   `availableTags` ï¼šæŒ‡æ ‡çš„æ ‡ç­¾æ•°ç»„ã€‚è¿™é‡Œï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®šä¹‰çš„é€šç”¨æ ‡ç­¾ `application = demo-application` ã€‚

å…¶å®ƒæŒ‡æ ‡çš„æ•°å€¼ï¼Œèƒ–å‹è‡ªè¡Œè®¿é—® [http://127.0.0..1:8080/actuator/metrics/{name}](http://127.0.0..1:8080/actuator/metrics/%7Bname%7D) åœ°å€ã€‚

6.2 è‡ªå®šä¹‰æŒ‡æ ‡
---------

åœ¨ Spring Boot 2.X çš„ç‰ˆæœ¬ï¼Œå…¶æŒ‡æ ‡æ”¶é›†å™¨ (Metrics Collector) æ˜¯åŸºäº [Micrometer](https://github.com/micrometer-metrics/micrometer) æ¥å®ç°ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ Micrometer çš„ç®€ä»‹ï¼š

> FROM [ã€Šä½¿ç”¨ Micrometer è®°å½• Java åº”ç”¨æ€§èƒ½æŒ‡æ ‡ã€‹](http://www.iocoder.cn/Fight/j-using-micrometer-to-record-java-metric/?self)
> 
> Micrometer ä¸º Java å¹³å°ä¸Šçš„æ€§èƒ½æ•°æ®æ”¶é›†æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ APIï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ä½¿ç”¨ Micrometer çš„é€šç”¨ API æ¥æ”¶é›†æ€§èƒ½æŒ‡æ ‡å³å¯ã€‚Micrometer ä¼šè´Ÿè´£å®Œæˆä¸ä¸åŒç›‘æ§ç³»ç»Ÿçš„é€‚é…å·¥ä½œã€‚è¿™å°±ä½¿å¾—åˆ‡æ¢ç›‘æ§ç³»ç»Ÿå˜å¾—å¾ˆå®¹æ˜“ã€‚Micrometer è¿˜æ”¯æŒæ¨é€æ•°æ®åˆ°å¤šä¸ªä¸åŒçš„ç›‘æ§ç³»ç»Ÿã€‚
> 
> åœ¨ Java åº”ç”¨ä¸­ä½¿ç”¨ Micrometer éå¸¸çš„ç®€å•ã€‚åªéœ€è¦åœ¨ Maven æˆ– Gradle é¡¹ç›®ä¸­æ·»åŠ ç›¸åº”çš„ä¾èµ–å³å¯ã€‚Micrometer åŒ…å«å¦‚ä¸‹ä¸‰ç§æ¨¡å—ï¼Œåˆ†ç»„åç§°éƒ½æ˜¯ [`io.micrometer`](https://mvnrepository.com/artifact/io.micrometer)ï¼š
> 
> *   åŒ…å«æ•°æ®æ”¶é›† SPI å’ŒåŸºäºå†…å­˜çš„å®ç°çš„æ ¸å¿ƒæ¨¡å— [micrometer-core](https://github.com/micrometer-metrics/micrometer/tree/master/micrometer-core)ã€‚
> *   é’ˆå¯¹ä¸åŒç›‘æ§ç³»ç»Ÿçš„å®ç°æ¨¡å—ï¼Œå¦‚é’ˆå¯¹ Prometheus çš„ [micrometer-registry-prometheus](https://github.com/micrometer-metrics/micrometer/tree/master/implementations/micrometer-registry-prometheus)ã€‚
> *   ä¸æµ‹è¯•ç›¸å…³çš„æ¨¡å— [micrometer-test](https://github.com/micrometer-metrics/micrometer/tree/master/micrometer-test)ã€‚

åœ¨ Micrometer ä¸­ï¼Œå®šä¹‰äº† [Meter](https://github.com/micrometer-metrics/micrometer/blob/master/micrometer-core/src/main/java/io/micrometer/core/instrument/Meter.java) æ¥å£ï¼Œç”¨äºæ”¶é›†åº”ç”¨ä¸­çš„ Metrics æ•°æ®çš„æ¥å£ã€‚å…¶æœ‰ 5 ç§å®ç°å¤§ç±»ï¼šCounterã€Timerã€LongTaskTimerã€Gaugeã€DistributionSummaryã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯è§å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š

*   [ã€Šä½¿ç”¨ Micrometer è®°å½• Java åº”ç”¨æ€§èƒ½æŒ‡æ ‡ã€‹](http://www.iocoder.cn/Fight/j-using-micrometer-to-record-java-metric/?self)
*   [ã€ŠJVM åº”ç”¨åº¦é‡æ¡†æ¶ Micrometer å®æˆ˜ã€‹](http://www.iocoder.cn/Fight/jvm-micrometer-prometheus/?self)

æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬ä»¥ Counter ä¸¾ä¾‹å­ã€‚Counter ä½œä¸ºè®¡æ•°å™¨ï¼Œç”¨äºæ”¶é›†æŒ‡æ ‡ Metrics çš„æ€»æ•°ã€‚

*   é€‚ç”¨äº**ç´¯åŠ **æƒ…å†µä¸‹çš„ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œä¸‹å•æ€»æ•°ã€æ”¯ä»˜æ¬¡æ•°ã€HTTP è¯·æ±‚æ€»é‡ç­‰ç­‰ã€‚
*   å¯ä»¥é€šè¿‡ **Tag** å¯ä»¥åŒºåˆ†ç›¸åŒ Metrics åœ¨ä¸åŒçš„åœºæ™¯çš„è®¡æ•°ã€‚ä¾‹å¦‚ï¼š
    *   å¯¹äºä¸‹å•ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ Tag æ ‡è®°ä¸åŒçš„ä¸šåŠ¡æ¥æºæˆ–è€…æ˜¯æŒ‰æ—¥æœŸåˆ’åˆ†ã€‚
    *   å¯¹äº HTTP è¯·æ±‚æ€»é‡è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ Tag åŒºåˆ†ä¸åŒçš„ URL ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæ”¶é›†æŸä¸ª API æ¥å£çš„è¯·æ±‚æ€»æ•°çš„ Counter ã€‚ğŸ˜ˆ è¿˜æ˜¯åœ¨ [lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/) é¡¹ç›®ä¸Šè¿›è¡Œä¿®æ”¹ã€‚

### 6.2.1 DemoController

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.controller`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/controller/) åŒ…è·¯å¾„ä¸‹ï¼Œåˆ›å»º [DemoController](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/controller/DemoController.java) ç±»ï¼Œæä¾›æµ‹è¯• API æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@RestController
@RequestMapping("/demo")
public class DemoController {

    


     
    private static final Counter METRICS_DEMO_COUNT = Counter
            .builder("demo.visit.count") 
            .description("demo è®¿é—®æ¬¡æ•°") 
            .baseUnit("æ¬¡") 
            .tag("test", "nicai") 
            .register(Metrics.globalRegistry); 


    @GetMapping("/visit")
    public String visit() {
        
        METRICS_DEMO_COUNT.increment();
        return "Demo ç¤ºä¾‹";
    }

}
```

*   `<1>` å¤„ï¼Œä½¿ç”¨ [`Counter.Builder`](https://github.com/micrometer-metrics/micrometer/blob/master/micrometer-core/src/main/java/io/micrometer/core/instrument/Counter.java#L57-L130) æ„å»ºä¸€ä¸ª [Counter](https://github.com/micrometer-metrics/micrometer/blob/master/micrometer-core/src/main/java/io/micrometer/core/instrument/Counter.java) ã€‚
*   `<2>` å¤„ï¼Œåœ¨æ¯æ¬¡ `/demo/visit` æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œéƒ½å¢åŠ ä¸€æ¬¡ `METRICS_DEMO_COUNT` è®¡æ•°ã€‚

ğŸ˜ˆ æ˜¯ä¸æ˜¯è‡ªå®šä¹‰ä¸€ä¸ª Counter å¹¶è¿›è¡Œè®¡æ•°ï¼Œè¿˜æ˜¯è›®ç®€å•çš„ï¼Œå˜¿å˜¿ã€‚

### 6.2.2 ç®€å•æµ‹è¯•

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

é¦–å…ˆï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/demo/visit](http://127.0.0.1:8080/demo/visit) åœ°å€ï¼Œè®©æŒ‡æ ‡ `"demo.visit.count"` çš„è®¡æ•°å¢åŠ  2 æ¬¡ã€‚

ç„¶åï¼Œç»§ç»­æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/metrics/demo.visit.count](http://127.0.0.1:8080/actuator/metrics/demo.visit.count) åœ°å€ï¼Œè·å¾— `"demo.visit.count"` æŒ‡æ ‡çš„æ•°å€¼ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "name": "demo.visit.count",
    "description": "demo è®¿é—®æ¬¡æ•°",
    "baseUnit": "æ¬¡",
    "measurements": [
        {
            "statistic": "COUNT",
            "value": 2
        }
    ],
    "availableTags": [
        {
            "tag": "test",
            "values": [
                "nicai"
            ]
        },
        {
            "tag": "application",
            "values": [
                "demo-application"
            ]
        }
    ]
}
```

*   çœ‹åˆ° `measurements` æ•°å€¼ä¸º 2 ï¼ŒæˆåŠŸã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `metrics` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 6. Metricsã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-metrics)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-httptrace](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-httptrace/) ã€‚

`httptrace` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/httptrace` æ¥å£ï¼Œå¯¹åº” [HttpTraceEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/trace/http/HttpTraceEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„æœ€è¿‘çš„ HTTP è·Ÿè¸ªä¿¡æ¯ ( [HttpTrace](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/trace/http/HttpTrace.java) )ã€‚`httptrace` ç«¯ç‚¹é€šè¿‡ [TraceRepository](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/trace/http/HttpTrace.java) è·å–æœ€è¿‘çš„ HttpTraceã€‚Actuator å†…ç½®äº† [InMemoryHttpTraceRepository](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/trace/http/InMemoryHttpTraceRepository.java) å®ç°ç±»ï¼Œå­˜å‚¨**æœ€è¿‘çš„ 100 æ¡** HttpTrace åˆ°**å†…å­˜**ä¸­ã€‚

åœ¨ SpringMVC ä¸­ï¼Œé€šè¿‡ [HttpTraceFilter](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/trace/servlet/HttpTraceFilter.java) è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œè®°å½• HttpTrace åˆ° TraceRepository ä¸­ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ `httptrace` ç«¯ç‚¹çš„ç¤ºä¾‹ï¼Œè€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-httptrace](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-httptrace/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

7.1 é…ç½®æ–‡ä»¶
--------

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-httptrace/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  `httptrace` ç«¯ç‚¹çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    httptrace:
      enabled: true 
  
  trace:
    http:
      enabled: true 
      include: 

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude:
```

é¢å¤–å¢åŠ  `management.endpoint.httptrace` é…ç½®é¡¹ï¼Œè®¾ç½® `httptrace` ç«¯ç‚¹çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [HttpTraceEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° `httptrace` ç«¯ç‚¹çš„é…ç½®ã€‚
*   `enabled` ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.endpoint.httptrace` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

é¢å¤–å¢åŠ  `management.trace.http` é…ç½®é¡¹ï¼Œè®¾ç½® HttpTrace çš„å…·ä½“é…ç½®é¡¹ï¼Œå¯¹åº” [HttpTraceProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceProperties.java) é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [HttpTraceAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° HttpTrace ç›¸å…³ç»„ä»¶çš„é…ç½®ï¼Œä¾‹å¦‚è¯´ HttpTraceFilter è¿‡æ»¤å™¨ã€‚
*   `enabled` å±æ€§ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   `include` å±æ€§ï¼šåŒ…å«çš„ [Include](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/trace/http/Include.java) çš„æ•°ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè€ƒè™‘å®‰å…¨æ€§ï¼Œä¸åŒ…å« `COOKIE_HEADERS`ã€`AUTHORIZATION_HEADER` é¡¹ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.trace.http` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

7.2 ActuateConfig
-----------------

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.config`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-httptrace/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/) åŒ…ä¸‹ï¼Œåˆ›å»º [ActuateConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-httptrace/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/ActuateConfig.java) é…ç½®ç±»ï¼Œé…ç½®ä¸€ä¸ª HttpTraceRepository Beanã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Configuration
public class ActuateConfig {

    @Bean
    public HttpTraceRepository httpTraceRepository() {
        return new InMemoryHttpTraceRepository();
    }

}
```

*   å†…éƒ¨åˆ›å»ºçš„æ˜¯ InMemoryHttpTraceRepository å¯¹è±¡ã€‚

ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦é…ç½®ä¸€ä¸ª HttpTraceRepository å‘¢ï¼ŸHttpTraceEndpointAutoConfiguration è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œåˆ›å»º HttpTraceEndpoint çš„å‰ææ˜¯ï¼Œéœ€è¦æœ‰ä¸€ä¸ª HttpTraceRepository Bean ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ ActuateConfig ä¸­ï¼Œé…ç½®äº† InMemoryHttpTraceRepository å¯¹è±¡ã€‚

7.3 ç®€å•æµ‹è¯•
--------

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/httptrace](http://127.0.0.1:8080/actuator/httptrace) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„æœ€è¿‘çš„ HTTP è·Ÿè¸ªä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "traces": [
        {
            "timestamp": "2019-12-21T18:45:35.145Z",
            "principal": null,
            "session": null,
            "request": {
                "method": "GET",
                "uri": "http://127.0.0.1:8080/actuator/httptrace",
                "headers": {},
                "remoteAddress": null
            },
            "response": {
                "status": 200,
                "headers": {}
            },
            "timeTaken": null
        }
        
        // ... çœç•¥å…¶å®ƒ
    ]
}
```

*   `principal` ï¼šè¯·æ±‚ä¸»ä½“ã€‚
*   `session` ï¼šSession ç¼–å·ã€‚
*   `request` ï¼šè¯·æ±‚ä¿¡æ¯ã€‚
*   `response` ï¼šå“åº”ä¿¡æ¯ã€‚
*   `timestamp` ï¼šè¯·æ±‚æ—¶é—´ã€‚
*   `timeTaken` ï¼šæ¶ˆè€—æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚

å¦‚æœèƒ–å‹å¸Œæœ›å­˜å‚¨ HttpTrace åˆ°æ•°æ®åº“ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç° HttpTraceRepositoryã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `httptrace` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 8. HTTP Tracingã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-http-tracing)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-auditevents](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/) ã€‚

`auditevents` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/auditevents` æ¥å£ï¼Œå¯¹åº” [AuditEventsEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/audit/AuditEventsEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„æœ€è¿‘çš„å®¡è®¡äº‹ä»¶ ( [AuditEvents](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/audit/AuditEvent.java) )ã€‚`httptrace` ç«¯ç‚¹é€šè¿‡ [AuditEventRepository](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/audit/AuditEventRepository.java) è·å–æœ€è¿‘çš„ AuditEventsã€‚Actuator å†…ç½®äº† [InMemoryAuditEventRepository](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/audit/InMemoryAuditEventRepository.java) å®ç°ç±»ï¼Œå­˜å‚¨**æœ€è¿‘çš„ 1000 æ¡** AuditEvents åˆ°**å†…å­˜**ä¸­ã€‚

åœ¨ Actuator ä¸­ï¼Œé€šè¿‡ [AuditListener](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/audit/listener/AuditListener.java) ç›‘å¬å™¨ï¼Œç›‘å¬ AuditEvent äº‹ä»¶ï¼Œè®°å½• AuditEvent åˆ° AuditEventRepository ä¸­ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ `auditevents` ç«¯ç‚¹çš„ç¤ºä¾‹ï¼Œè€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-auditevents](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

8.1 å¼•å…¥ä¾èµ–
--------

åœ¨ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/pom.xml) æ–‡ä»¶ä¸­ï¼Œ**å¢åŠ **å¼•å…¥ `spring-boot-starter-security` ç›¸å…³ä¾èµ–ã€‚

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
    <version>2.2.0.RELEASE</version> 
</dependency>
```

åœ¨ Spring Security ä¸­ï¼Œè®¤è¯æˆåŠŸæˆ–å¤±è´¥æ—¶ï¼Œ[AuthenticationAuditListener](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/security/AuthenticationAuditListener.java) ä¼šç›‘å¬ AuthenticationSuccessEvent æˆ– AbstractAuthenticationFailureEvent äº‹ä»¶ï¼Œä»è€Œå‘å¸ƒ AuditEvent äº‹ä»¶ã€‚

8.2 é…ç½®æ–‡ä»¶
--------

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  `auditevents` ç«¯ç‚¹çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
management:
  endpoint:
    
    auditevents:
      enabled: true 

  endpoints:
    
    web:
      base-path: /actuator 
      exposure:
        include: '*' 
        exclude: 

spring:
  
  security:
    
    user:
      name: user 
      password: user
```

é¢å¤–å¢åŠ  `management.endpoint.auditevents` é…ç½®é¡¹ï¼Œè®¾ç½® `auditevents` ç«¯ç‚¹çš„é…ç½®é¡¹ï¼Œæ— å¯¹åº”é…ç½®ç±»ã€‚

*   Spring Boot æä¾›çš„ [AuditEventsEndpointAutoConfiguration](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/audit/AuditEventsEndpointAutoConfiguration.java) è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° `auditevents` ç«¯ç‚¹çš„é…ç½®ã€‚
*   `enabled` ï¼šæ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º `true` å¼€å¯ã€‚
*   è¿™é‡Œï¼Œè‰¿è‰¿ä¸»è¦æ˜¯ä¸ºäº†è®©èƒ–å‹äº†è§£ `management.endpoint.auditevents` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€**ä¸»åŠ¨**é…ç½®å®ƒï¼Œé»˜è®¤å³å¯ã€‚

é¢å¤–å¢åŠ  `spring.security` é…ç½®é¡¹ï¼Œå¢åŠ ã€Œuser/userã€è´¦å·ã€‚

8.3 ActuateConfig
-----------------

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.config`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/) åŒ…ä¸‹ï¼Œåˆ›å»º [ActuateConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-auditevents/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/ActuateConfig.java) é…ç½®ç±»ï¼Œé…ç½®ä¸€ä¸ª AuditEventRepository Beanã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Configuration
public class ActuateConfig {

    @Bean
    public AuditEventRepository auditEventRepository() {
        return new InMemoryAuditEventRepository();
    }

}
```

*   å†…éƒ¨åˆ›å»ºçš„æ˜¯ InMemoryAuditEventRepository å¯¹è±¡ã€‚

ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦é…ç½®ä¸€ä¸ª AuditEventRepository å‘¢ï¼ŸAuditEventsEndpointAutoConfiguration è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œåˆ›å»º AuditEventsEndpoint çš„å‰ææ˜¯ï¼Œéœ€è¦æœ‰ä¸€ä¸ª AuditEventRepository Bean ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ ActuateConfig ä¸­ï¼Œé…ç½®äº† InMemoryAuditEventRepository å¯¹è±¡ã€‚

8.4 ç®€å•æµ‹è¯•
--------

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

é¦–å…ˆï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/login](http://127.0.0.1:8080/login) åœ°å€ï¼Œä½¿ç”¨ã€Œuser/userã€è´¦å·ï¼Œè¿›è¡Œç™»å½•ã€‚

ç„¶åï¼Œç»§ç»­æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/auditevents](http://127.0.0.1:8080/actuator/auditevents) åœ°å€ï¼Œè·å–åº”ç”¨çš„æœ€è¿‘çš„ AuditEvents ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
  "events": [
    {
      "timestamp": "2019-12-22T02:25:35.035Z",
      "principal": "anonymousUser",
      "type": "AUTHORIZATION_FAILURE",
      "data": {
        "details": {
          "remoteAddress": "127.0.0.1",
          "sessionId": null
        },
        "type": "org.springframework.security.access.AccessDeniedException",
        "message": "Access is denied"
      }
    },
    {
      "timestamp": "2019-12-22T02:25:44.015Z",
      "principal": "user",
      "type": "AUTHENTICATION_SUCCESS",
      "data": {
        "details": {
          "remoteAddress": "127.0.0.1",
          "sessionId": "5F55B4F20774FE5AADA04FBECD0437A3"
        }
      }
    }
  ]
}
```

*   `type` ï¼šå®¡è®¡äº‹ä»¶çš„ç±»å‹ã€‚
*   `timestamp` ï¼šå®¡è®¡äº‹ä»¶çš„æ—¶é—´ã€‚
*   `principal` ï¼šè¯·æ±‚ä¸»ä½“ã€‚
*   `data` ï¼šæ˜ç»†æ•°æ®ã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `auditevents` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 7. Auditingã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-auditing)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) ã€‚

`beans` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/beans` æ¥å£ï¼Œå¯¹åº” [BeansEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/beans/BeansEndpoint.java) ç±»ã€‚

ç”¨äºè·å¾—åº”ç”¨çš„æ‰€æœ‰ Spring Bean ä¿¡æ¯ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/beans](http://127.0.0.1:8080/actuator/beans) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„æ‰€æœ‰ Spring Bean ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/09.png)

*   å“åº”çš„ç»“æœï¼Œæ¯ä¸ª `beans` çš„å…ƒç´ ï¼Œå¯¹åº” [BeansEndpoint.BeanDescriptor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/beans/BeansEndpoint.java#L146-L190) ç±»ã€‚
*   `beans` çš„ Key ï¼šBean çš„åå­—ã€‚
*   `aliases` ï¼šBean çš„åˆ«åæ•°ç»„ã€‚
*   `type` ï¼šBean çš„ç±»å‹ã€‚
*   `resource` ï¼šåˆ›å»ºè¯¥ Bean çš„èµ„æºã€‚é€šè¿‡è¯¥å±æ€§ï¼Œæˆ‘ä»¬çŸ¥é“è¯¥ Bean æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚
*   `dependencies` ï¼šåˆ›å»ºè¯¥ Bean ä¾èµ–çš„å…¶å®ƒ Bean çš„åå­—ã€‚
*   `scope` ï¼šBean çš„ä½œç”¨åŸŸã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) ã€‚

`conditions` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/conditions` æ¥å£ï¼Œå¯¹åº” [ConditionsReportEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java) ç±»ã€‚

ç”¨äºè·å¾— Spring Boot åŸºäº [Condition](https://reflectoring.io/spring-boot-conditionals/) æ¡ä»¶åˆ›å»º Bean çš„æƒ…å†µã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š

*   å¦‚æœä¸€ä¸ª Bean è¢«åˆ›å»ºï¼Œæ˜¯å› ä¸º**æ»¡è¶³**äº†ä»€ä¹ˆæ¡ä»¶ã€‚
*   å¦‚æœä¸€ä¸ª Bean æœªè¢«åˆ›å»ºï¼Œæ˜¯å› ä¸º**ä¸æ»¡è¶³**ä»€ä¹ˆæ¡ä»¶ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ `conditions` ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ’æŸ¥åŸºäº Condition çš„ Bean ä¸ºä»€ä¹ˆè¢«åˆ›å»ºï¼Œä¸ºä»€ä¹ˆæ²¡è¢«åˆ›å»ºã€‚ğŸ˜ˆ åœ¨ Spring Boot æä¾›è‡ªåŠ¨åŒ–é…ç½®çš„éå†çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦ç»™æˆ‘ä»¬ä¸ºä»€ä¹ˆæŸä¸ª Bean è¢«åˆ›å»ºæˆ–æœªè¢«åˆ›å»ºçš„å›°æ‰°ï¼Œé€šè¿‡ `conditions` ç«¯ç‚¹å°±å¯ä»¥å¾ˆå¥½çš„æ’æŸ¥å’Œè§£å†³äº†ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/conditions](http://127.0.0.1:8080/actuator/conditions) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„æ‰€æœ‰ Spring Bean ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
  "contexts": {
    "application": {
      "positiveMatches": {
        "AuditEventsEndpointAutoConfiguration": [
          {
            "condition": "OnAvailableEndpointCondition",
            "message": "@ConditionalOnAvailableEndpoint no property management.endpoint.auditevents.enabled found so using endpoint default; @ConditionalOnAvailableEndpoint marked as exposed by a 'management.endpoints.web.exposure' property"
          }
          // ... çœç•¥å…¶å®ƒ
        ]
      },
      "negativeMatches": {
        "RabbitHealthContributorAutoConfiguration": {
          "notMatched": [
            {
              "condition": "OnClassCondition",
              "message": "@ConditionalOnClass did not find required class 'org.springframework.amqp.rabbit.core.RabbitTemplate'"
            }
          ],
          "matched": []
        }
        // ... çœç•¥å…¶å®ƒ
      },
      "unconditionalClasses": [
        "org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration",
        // ... çœç•¥å…¶å®ƒ
      ]
    }
  }
}
```

*   æ•´ä¸ªå“åº”ç»“æœï¼Œå¯¹åº” [ConditionsReportEndpoint.ContextConditionEvaluation](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java#L99-L157) ç±»ã€‚
*   `positiveMatches` ï¼š**æˆåŠŸ**è¢«åˆ›å»º Bean çš„æ¡ä»¶æ˜ç»† MultiValueMap ã€‚
    *   KEY ï¼šå¯¹åº”æ¯ä¸ª Bean çš„åå­—ã€‚
    *   VALUE ï¼š æ¡ä»¶æ˜ç»†æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº” [MessageAndCondition](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java#L187-L217) ç±»ã€‚
        *   `condition` ï¼šæ¡ä»¶ç±»å‹ã€‚
        *   `message` ï¼šæ¡ä»¶æè¿°ã€‚
*   `negativeMatches` ï¼š**æœªæˆåŠŸ**è¢«åˆ›å»º Bean çš„æ¡ä»¶æ˜ç»† Map ã€‚
    *   KEY ï¼šå¯¹åº”æ¯ä¸ª Bean çš„åå­—ã€‚
    *   VALUE ï¼š åŒ¹é…æ¡ä»¶å’ŒæœªåŒ¹é…çš„æ¡ä»¶æ˜ç»†ï¼Œå¯¹åº” [MessageAndConditions](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java#L159-L185) ç±»ã€‚
        *   `notMatched` ï¼šåŒ¹é…æ¡ä»¶çš„æ˜ç»†æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº” [MessageAndCondition](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java#L187-L217) ç±»ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `notMatched` æ¥çŸ¥é“è¯¥ Bean æœªè¢«åˆ›å»ºï¼Œæ˜¯å› ä¸ºä¸æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ã€‚ä¾‹å¦‚è¿™é‡Œï¼ŒRabbitHealthContributorAutoConfiguration æœªè¢«è‡ªåŠ¨åŒ–é…ç½®çš„åŸå› ï¼Œæ˜¯å› ä¸º RabbitTemplate ç±»ä¸å­˜åœ¨ã€‚
        *   `matched` ï¼šä¸åŒ¹é…æ¡ä»¶çš„æ˜ç»†æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº” [MessageAndCondition](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpoint.java#L187-L217) ç±»ã€‚
*   `unconditionalClasses` ï¼šä¸åŒ…å«ä»»ä½•**ç±»**çº§åˆ«çš„æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç±»å§‹ç»ˆä¼šè¢«è‡ªåŠ¨åŠ è½½ã€‚
*   `exclusions` ï¼šåº”ç”¨æ˜ç¡®æ’é™¤çš„é…ç½®ç±»ã€‚æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰é…ç½®ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) ã€‚

`env` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/env` å’Œ `GET /actuator/env/{name}` æ¥å£ï¼Œå¯¹åº” [EnvironmentEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/env/EnvironmentEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨ä¸­æ‰€æœ‰**å¯ç”¨çš„** Spring [PropertySource](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/env/PropertySource.java) é…ç½®æ¥æºã€‚Spring Boot å¯¹åº”çš„ PropertySource éå¸¸å¤šï¼š

*   åº”ç”¨çš„ YAML é…ç½®æ–‡ä»¶ã€Properties é…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚è¯´ï¼Œ`application.yaml`ã€`application.properties` ã€‚
*   å‘½ä»¤è¡ŒæŒ‡å®šçš„å‚æ•°ã€‚ä¾‹å¦‚ `java -jar springboot.jar --server.port=9090` ã€‚
*   Java ç³»ç»Ÿå˜é‡ï¼Œå³ `System#getProperties()` ã€‚
*   æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚
*   æ›´å¤šçš„å¯ä»¥çœ‹çœ‹ [ã€ŠSpring Boot Features â€”â€” 2. Externalized Configurationã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config) ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/env](http://127.0.0.1:8080/actuator/env) åœ°å€ï¼Œè·å–åº”ç”¨ä¸­æ‰€æœ‰**å¯ç”¨çš„** Spring PropertySource é…ç½®æ¥æºã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/10.png)

*   æ•´ä¸ªå“åº”ç»“æœï¼Œå¯¹åº” [EnvironmentEndpoint.EnvironmentEntryDescriptor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/env/EnvironmentEndpoint.java#L239-L270) ç±»ã€‚
*   `activeProfiles` ï¼šæ¿€æ´»çš„ Profile æ•°ç»„ã€‚
*   `propertySources` ï¼š[EnvironmentEndpoint.PropertySourceDescriptor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/env/EnvironmentEndpoint.java#L297-L319) æ•°ç»„ã€‚
    *   `name` ï¼šPropertySource çš„åå­—ã€‚
    *   `properties` ï¼šå…·ä½“é…ç½®é¡¹ Map ï¼Œæ¯ä¸ªé…ç½®é¡¹å¯¹åº” [EnvironmentEndpoint.PropertyValueDescriptor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/env/EnvironmentEndpoint.java#L346-L369) ç±»ã€‚
        *   KEY ï¼šé…ç½®é¡¹çš„é”®ã€‚
        *   `value` ï¼šé…ç½®é¡¹çš„å€¼ã€‚
        *   `origin` ï¼šé…ç½®é¡¹çš„æ¥æºã€‚ä¾‹å¦‚è¯´ï¼Œåœ¨ YAML é…ç½®æ–‡ä»¶çš„ç¬¬å‡ è¡Œã€‚

å¦å¤–è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œå¯¹äºé…ç½®é¡¹ KEY åŒ…å« `"password"`ã€`secret`ã€`key`ã€`token` ç­‰æ—¶ï¼Œå…¶ `value` ä¼šä½¿ç”¨åŠ å¯†æˆ `"******"` å­—ç¬¦ä¸²ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [Sanitizer](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/endpoint/Sanitizer.java) ç±»çš„ä»£ç ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) ã€‚

`configprops` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/configprops` æ¥å£ï¼Œå¯¹åº” [ConfigurationPropertiesReportEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/context/properties/ConfigurationPropertiesReportEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨ä¸­æ‰€æœ‰**æœ‰æ•ˆçš„** Spring [`@ConfigurationProperties`](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/properties/ConfigurationProperties.java) æ³¨è§£çš„é…ç½®å±æ€§ç±»ã€‚ä¾‹å¦‚è¯´ï¼Œ`"spring.jdbc"` é…ç½®å¯¹åº”çš„ [JdbcProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/JdbcProperties.java) é…ç½®å±æ€§ç±»ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/configprops](http://127.0.0.1:8080/actuator/configprops) åœ°å€ï¼Œè·å–åº”ç”¨ä¸­æ‰€æœ‰**æœ‰æ•ˆçš„** Spring `@ConfigurationProperties` æ³¨è§£çš„é…ç½®å±æ€§ç±»ã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/11.png)

*   æ•´ä¸ªå“åº”ç»“æœï¼Œå¯¹åº” [ConfigurationPropertiesReportEndpoint.ApplicationConfigurationProperties](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/context/properties/ConfigurationPropertiesReportEndpoint.java#L476-L493) ç±»ã€‚
*   `beans` ï¼š[ConfigurationPropertiesReportEndpoint.ConfigurationPropertiesBeanDescriptor](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/context/properties/ConfigurationPropertiesReportEndpoint.java#L522-L553) Map ã€‚
    *   KEY ï¼šé…ç½®å±æ€§ç±»çš„å…¨ç±»åã€‚
    *   `prefix` ï¼šé…ç½®å±æ€§çš„å‰ç¼€ã€‚
    *   `properties` ï¼šå…·ä½“é…ç½®é¡¹ Map ï¼Œæ¯ä¸ªé…ç½®é¡¹å¯¹åº”ä¸€ä¸ªé”®å€¼å¯¹ã€‚

å¦å¤–è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œå¯¹äº `properties` çš„æ¯ä¸ªé…ç½®é¡¹ KEY åŒ…å« `"password"`ã€`secret`ã€`key`ã€`token` ç­‰æ—¶ï¼Œå…¶ VALUE ä¼šä½¿ç”¨åŠ å¯†æˆ `"******"` å­—ç¬¦ä¸²ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [Sanitizer](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/endpoint/Sanitizer.java) ç±»çš„ä»£ç ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/) ã€‚

`mappings` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/mappings` æ¥å£ï¼Œå¯¹åº” [MappingsEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/MappingsEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„ HTTP è¯·æ±‚åŒ¹é… (Mapping) ä¿¡æ¯ã€‚`mappings` ç«¯ç‚¹é€šè¿‡ [MappingDescriptionProvider](https://github.com/Diffblue-benchmarks/Spring-projects-spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/MappingDescriptionProvider.java) ï¼Œè·å–ä¸åŒç±»å‹çš„ HTTP è¯·æ±‚åŒ¹é…ä¿¡æ¯ã€‚Actuator å†…ç½®äº†å¤šä¸ª MappingDescriptionProvider å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/12.png)

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics) é¡¹ç›®å³å¯ã€‚ğŸ˜ˆ å› ä¸ºæˆ‘ä»¬åœ¨é‡Œé¢åˆ›å»ºäº† [DemoController](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/controller/DemoController.java) ç±»ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/mappings](http://127.0.0.1:8080/actuator/mappings) åœ°å€ï¼Œè·å–åº”ç”¨çš„ HTTP è¯·æ±‚åŒ¹é… (Mapping) ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/13.png)

*   æ•´ä¸ªå“åº”ç»“æœï¼Œå¯¹åº” [MappingsEndpoint.ApplicationMappings](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/MappingsEndpoint.java#L64-L80) ç±»ã€‚
*   `dispatcherServlets` ï¼šç”± [DispatcherServletsMappingDescriptionProvider](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/DispatcherServletsMappingDescriptionProvider.java) æä¾›ï¼Œé’ˆå¯¹ SpringMVC [DispatcherServlet](https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/DispatcherServlet.java) ã€‚`dispatcherServlets` Map çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯¹åº”ä¸€ä¸ª SpringMVC DispatcherServlet ã€‚å…¶ KEY ä¸º DispatcherServlet çš„åå­—ï¼ŒVALUE ä¸º Mapping æ•°ç»„ï¼Œå¯¹åº” [DispatcherServletMappingDescription](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/DispatcherServletMappingDescription.java) ç±»ã€‚æˆ‘ä»¬æ¥ç®€å•çœ‹çœ‹ DispatcherServletMappingDescription çš„æ¯ä¸ªå­—æ®µï¼š
    *   `handler` ï¼šï¼ˆç®€å•ï¼‰å¯¹åº” Handler çš„ç±»ä¸æ–¹æ³•ã€‚
    *   `mappings` ï¼šï¼ˆç®€å•ï¼‰å¯¹åº”çš„åŒ¹é…çš„è¯·æ±‚ Method ä¸ URI æ¡ä»¶ã€‚
    *   `details.handlerMethod` ï¼šï¼ˆè¯¦ç»†ï¼‰å¯¹åº” Handler çš„ç±»ä¸æ–¹æ³•ã€‚
    *   `details.requestMappingConditions` ï¼šï¼ˆè¯¦ç»†ï¼‰å¯¹åº”çš„åŒ¹é…çš„å®Œæ•´æ¡ä»¶ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬åœ¨ `@RequestMapping` æ³¨è§£ä¸Šæ·»åŠ çš„åŒ¹é…æ¡ä»¶ã€‚
*   `servlets` ï¼šç”± [ServletsMappingDescriptionProvider](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/ServletsMappingDescriptionProvider.java) æä¾›ï¼Œé’ˆå¯¹ J2EE Servlet ã€‚`servlets` æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯¹åº” [ServletRegistrationMappingDescription](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/ServletRegistrationMappingDescription.java) ç±»ï¼Œæ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±å»ç…ç…å³å¯ã€‚
*   `filters` ï¼šç”± [FiltersMappingDescriptionProvider](https://github.com/Diffblue-benchmarks/Spring-projects-spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/FiltersMappingDescriptionProvider.java) æä¾›ï¼Œé’ˆå¯¹ J2EE Filter ã€‚`filters` æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯¹åº” [FilterRegistrationMappingDescription](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/web/mappings/servlet/FilterRegistrationMappingDescription.java) ç±»ï¼Œæ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±å»ç…ç…å³å¯ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-metrics](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-metrics/) ã€‚

`loggings` ç«¯ç‚¹ï¼Œå¯¹åº” [LoggersEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/logging/LoggersEndpoint.java) ç±»ã€‚å¯¹åº”æ¥å£å¦‚ä¸‹ï¼š

*   `GET /actuator/loggers` æ¥å£ï¼Œè¿”å›æ‰€æœ‰ Logger çš„é…ç½®ä¿¡æ¯ã€‚
*   `GET /actuator/loggers/{name}` æ¥å£ï¼Œè·å–æŒ‡å®š Logger çš„é…ç½®ä¿¡æ¯ã€‚
*   `POST /actuator/loggers/{name}` æ¥å£ï¼Œä¿®æ”¹æŒ‡å®š Logger çš„æ—¥å¿—çº§åˆ«ã€‚

`loggers` ç«¯ç‚¹é€šè¿‡ [LoggingSystem](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/logging/LoggingSystem.java) ï¼Œè·å–ä¸åŒçš„æ—¥å¿—åº“çš„ Logger çš„é…ç½®ä¿¡æ¯ã€‚Actuator å†…ç½®äº†å¤šä¸ª LoggingSystem å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/14.png)

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/loggers](http://127.0.0.1:8080/actuator/loggers) åœ°å€ï¼Œè·å–åº”ç”¨ä¸­æ‰€æœ‰ Logger çš„é…ç½®ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "levels": ["OFF", "ERROR", "WARN", "INFO", "DEBUG", "TRACE" ],
    "loggers": {
        "ROOT": {
            "configuredLevel": "INFO",
            "effectiveLevel": "INFO"
        },
        // ... çœç•¥å…¶å®ƒ logger 
    },
    "groups": {
        "web": {
            "configuredLevel": null,
            "members": [
                "org.springframework.core.codec",
                "org.springframework.http",
                "org.springframework.web",
                "org.springframework.boot.actuate.endpoint.web",
                "org.springframework.boot.web.servlet.ServletContextInitializerBeans"
            ]
        },
        // ... çœç•¥å…¶å®ƒ group
    }
}
```

*   `levels` ï¼šæ”¯æŒçš„æ—¥å¿—çº§åˆ«æ•°ç»„ã€‚
*   `loggers` ï¼šæ‰€æœ‰ Logger çš„ Map ã€‚
    *   KEY ï¼šLogger åå­—ã€‚
    *   `configuredLevel` ï¼šé…ç½®çš„æ—¥å¿—çº§åˆ«ã€‚
    *   `effectiveLevel` ï¼šç”Ÿæ•ˆçš„æ—¥å¿—çº§åˆ«ã€‚
*   `groups` ï¼šæ‰€æœ‰ Logger åˆ†ç»„çš„ Map ã€‚Logger åˆ†ç»„æ˜¯ Spring Boot è‡ªå®šä¹‰çš„åŠŸèƒ½ï¼Œä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠèŠ‹é“ Spring Boot æ—¥å¿—é›†æˆ Logging å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Logging/?self) æ–‡ç« ã€‚
    *   KEY ï¼šLogger åˆ†ç»„çš„åå­—ã€‚
    *   `configuredLevel` ï¼šé…ç½®çš„æ—¥å¿—çº§åˆ«ã€‚
    *   `members` ï¼šåŒ…å«çš„ Logger æ•°ç»„ã€‚

å¦å¤–ï¼Œé€šè¿‡ `POST /actuator/loggers/{name}` æ¥å£ï¼Œå¯ä»¥åŠ¨æ€å®ç° Logger çš„æ—¥å¿—çº§åˆ«ä¿®æ”¹ã€‚å…·ä½“å¦‚ä½•å®ç°ï¼Œæˆ‘é—¨åœ¨ [ã€ŠèŠ‹é“ Spring Boot æ—¥å¿—é›†æˆ Logging å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Logging/?self) æ–‡ç« ä¸­çœ‹çœ‹ã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `loggers` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 5. Loggersã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-loggers)æ–‡æ¡£ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) ã€‚

`threaddump` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/threaddump` æ¥å£ï¼Œå¯¹åº” [ThreadDumpEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/management/ThreadDumpEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„æ‰€æœ‰**å­˜æ´»çš„**çº¿ç¨‹ä¿¡æ¯ã€‚`threaddump` ç«¯ç‚¹é€šè¿‡è°ƒç”¨ [`ThreadMXBean#dumpAllThreads(boolean lockedMonitors, boolean lockedSynchronizers)`](https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/lang/management/ThreadMXBean.java#L768-L805) æ–¹æ³•ï¼Œè¿›è¡Œçº¿ç¨‹ä¿¡æ¯çš„è·å–ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/mappings](http://127.0.0.1:8080/actuator/mappings) åœ°å€ï¼Œè·å–çº¿ç¨‹ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹å›¾ï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/15.png)

*   æ¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹åº” [`java.lang.management.ThreadInfo`](https://github.com/AdoptOpenJDK/openjdk-jdk11/blob/master/src/java.management/share/classes/java/lang/management/ThreadInfo.java) ç±»ã€‚å…·ä½“å­—æ®µçš„è§£é‡Šï¼Œè§ [ThreadInfo (Java Platform SE 8)](http://www.pbteach.com/resource/jdkapi/jdk-8_doc-api-cn/java/lang/management/ThreadInfo.html) ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) ã€‚

`heapdump` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/heapdump` æ¥å£ï¼Œå¯¹åº” [HeapDumpWebEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/management/HeapDumpWebEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨çš„ JVM Heap Dumpï¼ˆå †è½¬å‚¨æ–‡ä»¶ï¼‰ã€‚`heapdump` ç«¯ç‚¹é€šè¿‡è°ƒç”¨ [`HotSpotDiagnosticMXBean#dumpHeap(String outputFile, boolean live)`](https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/com/sun/management/HotSpotDiagnosticMXBean.java#L52-L70) æ–¹æ³•ï¼Œè¿›è¡Œ JVM Heap Dump çš„è·å–ã€‚

> å…³äº JVM Heap Dump çš„æ‹“å±•çŸ¥è¯†ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ [ã€ŠJVM æ•…éšœåˆ†æåŠæ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹å…­ï¼šJVM Heap Dumpï¼ˆå †è½¬å‚¨æ–‡ä»¶ï¼‰çš„ç”Ÿæˆå’Œ MAT çš„ä½¿ç”¨ã€‹](https://www.javatang.com/archives/2017/10/30/53562102.html) æ–‡ç« ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/heapdump](http://127.0.0.1:8080/actuator/heapdump) åœ°å€ï¼Œè·å–åº”ç”¨çš„ JVM Heap Dumpã€‚å› ä¸ºæ˜¯å †è½¬å‚¨**æ–‡ä»¶**ï¼Œæ‰€ä»¥ä¼šä¸‹è½½ä¸€ä¸ª heapdump æ–‡ä»¶ã€‚åç»­ï¼Œèƒ–å‹å¯ä»¥ä½¿ç”¨ [Memory Analyzer (MAT)](https://www.eclipse.org/mat/) å·¥å…·ï¼Œè¿›è¡Œ JVM å †å†…å­˜çš„åˆ†æã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) ã€‚

`shutdown` ç«¯ç‚¹ï¼Œå¯¹åº” `POST /actuator/shutdown` æ¥å£ï¼Œå¯¹åº” [ShutdownEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/context/ShutdownEndpoint.java) ç±»ã€‚

ç”¨äºè¿œç¨‹**ä¼˜é›…**å…³é—­åº”ç”¨ã€‚`shutdown` ç«¯ç‚¹é€šè¿‡è°ƒç”¨ Spring [`ConfigurableApplicationContext#close()`](https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/context/ConfigurableApplicationContext.java#L183-L192) æ–¹æ³•ï¼Œè¿›è¡Œåº”ç”¨çš„ä¼˜é›…å…³é—­ã€‚

å› ä¸º `shutdown` ç«¯ç‚¹å¯ä»¥å®ç°åº”ç”¨çš„å…³é—­ï¼Œæ˜¯ä¸ªç›¸å¯¹æ•æ„Ÿçš„æ“ä½œï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½® `management.endpoint.shutdown.enabled = true` æ¥è¿›è¡Œå¼€å¯ã€‚å¦å¤–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸€å®šè¦åšå¥½ `shutdown` ç«¯ç‚¹çš„å®‰å…¨é˜²æŠ¤æªæ–½ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨ Spring Security è¿›è¡Œå®‰å…¨è®¤è¯ã€ä»…å…è®¸å†…ç½‘ IP è®¿é—®ç­‰ç­‰ã€‚

è¿™ä¸ªç«¯ç‚¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å°±ä¸å•ç‹¬æ­å»ºé¡¹ç›®ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo) é¡¹ç›®å³å¯ã€‚

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

ä½¿ç”¨ [Postman](https://www.getpostman.com/)ï¼Œ**POST** è¯·æ±‚ [http://127.0.0.1:8080/actuator/shutdown](http://127.0.0.1:8080/actuator/shutdown) åœ°å€ï¼Œè¿›è¡Œåº”ç”¨çš„ä¼˜é›…å…³é—­ã€‚æ‰§è¡Œå®Œæˆåï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼Œæœ€ç»ˆåº”ç”¨è¢«å…³é—­ã€‚

```
2019-12-23 08:17:21.596  INFO 4178 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2019-12-23 08:17:21.597  INFO 4178 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2019-12-23 08:17:21.601  INFO 4178 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 4 ms
2019-12-23 08:17:22.159  INFO 4178 --- [       Thread-3] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService 'applicationTaskExecutor'

Process finished with exit code 0
```

`sessions` ç«¯ç‚¹ï¼Œå¯¹åº” [SessionsEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/session/SessionsEndpoint.java) ç±»ã€‚å¯¹åº”æ¥å£å¦‚ä¸‹ï¼š

*   `GET /actuator/sessions/?username=` æ¥å£ï¼Œè·å–æŒ‡å®š `username` å¯¹åº”çš„ Session ã€‚
*   `GET /actuator/sessions/{sessionId}` æ¥å£ï¼Œè·å–æŒ‡å®š `sessionId` å¯¹åº”çš„ Session ã€‚
*   `DELETE /actuator/sessions/{sessionId}` æ¥å£ï¼Œåˆ é™¤æŒ‡å®š `sessionId` å¯¹åº”çš„ Session ã€‚

`sessions` ç«¯ç‚¹ï¼Œæ˜¯åŸºäº [Spring Session](https://github.com/spring-projects/spring-session) è¿›è¡Œå®ç°ã€‚æš‚æ—¶ä¸æä¾›ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±å»å°è¯•ä¸€æ³¢ã€‚

æƒ³è¦å¯¹ Spring Session è¿›è¡Œäº†è§£çš„èƒ–å‹ï¼Œæ¬¢è¿é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot åˆ†å¸ƒå¼ Session å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Distributed-Session/?self)æ–‡ç« ã€‚

`scheduledtasks` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/scheduledtasks` æ¥å£ï¼Œå¯¹åº” [ScheduledTasksEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/scheduling/ScheduledTasksEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨ä¸­çš„å®šæ—¶ï¼ˆè°ƒåº¦ï¼‰ä»»åŠ¡ã€‚

æš‚æ—¶ä¸æä¾›ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±å»å°è¯•ä¸€æ³¢ã€‚

æƒ³è¦å¯¹ Spring å®šæ—¶ä»»åŠ¡è¿›è¡Œäº†è§£çš„èƒ–å‹ï¼Œæ¬¢è¿é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot å®šæ—¶ä»»åŠ¡å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Job/?self)æ–‡ç« ã€‚

`flyway` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/flyway` æ¥å£ï¼Œå¯¹åº” [FlywayEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/flyway/FlywayEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨ä¸­çš„å·²æ‰§è¡Œçš„ [Flyway](https://flywaydb.org/) æ•°æ®åº“è¿ç§»ã€‚

æš‚æ—¶ä¸æä¾›ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±å»å°è¯•ä¸€æ³¢ã€‚

æƒ³è¦å¯¹ Flyway è¿›è¡Œäº†è§£çš„èƒ–å‹ï¼Œæ¬¢è¿é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot//database-version-control/?self)æ–‡ç« çš„[ã€Œ2. Flywayã€](#)å°èŠ‚ã€‚

`liquibase` ç«¯ç‚¹ï¼Œå¯¹åº” `GET /actuator/liquibase` æ¥å£ï¼Œå¯¹åº” [LiquibaseEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/liquibase/LiquibaseEndpoint.java) ç±»ã€‚

ç”¨äºè·å–åº”ç”¨ä¸­çš„å·²æ‰§è¡Œçš„ [Liquibase](https://www.liquibase.org/) æ•°æ®åº“è¿ç§»ã€‚

æš‚æ—¶ä¸æä¾›ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±å»å°è¯•ä¸€æ³¢ã€‚

æƒ³è¦å¯¹ Liquibase è¿›è¡Œäº†è§£çš„èƒ–å‹ï¼Œæ¬¢è¿é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot//database-version-control/?self)æ–‡ç« çš„[ã€Œ3. Liquibaseã€](#)å°èŠ‚ã€‚

> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-34-actuator-demo-custom-endpoint](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-custom-endpoint/) ã€‚

åœ¨ä¸Šè¿°å°èŠ‚çš„å†…å®¹ï¼Œæˆ‘ä»¬çœ‹äº† Actuator æä¾›çš„å¾ˆå¤šå†…ç½®ç«¯ç‚¹ã€‚æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Actuator **è‡ªå®šä¹‰**ç«¯ç‚¹ã€‚

è€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-custom-endpoint](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-custom-endpoint/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

22.1 DemoEndPoint
-----------------

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.endpoint`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-34/lab-34-actuator-demo-custom-endpoint/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/endpoint/) åŒ…è·¯å¾„ä¸‹ï¼Œåˆ›å»º [DemoEndPoint](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-custom-endpoint/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/endpoint/DemoEndPoint.java) ç±»ï¼Œç¤ºä¾‹ EndPointã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Component
@Endpoint(id = "demo")
public class DemoEndPoint {

    @ReadOperation
    public Map<String, String> hello() {
        Map<String, String> result = new HashMap<>();
        result.put("ä½œè€…", "yudaoyuanma");
        result.put("ç§ƒå¤´", "true");
        return result;
    }

}
```

*   åœ¨ç±»ä¸Šï¼Œæ·»åŠ  `@Component` æ³¨è§£ï¼Œä¿è¯åˆ›å»ºä¸€ä¸ª Bean ï¼Œè¢« Spring æ‰«æåˆ°ã€‚
*   åœ¨ç±»ä¸Šï¼Œæ·»åŠ  `@Endpoint` æ³¨è§£ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª Actuator Endpoint ç«¯ç‚¹ã€‚åŒæ—¶ï¼Œè®¾ç½® `id = "demo"` ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `/actuator/demo` åœ°å€è¿›è¡Œè®¿é—®ã€‚
*   åœ¨ `#hello()` æ–¹æ³•ä¸Šï¼Œæ·»åŠ  `@ReadOperation` æ³¨è§£ï¼Œè¡¨ç¤ºå®ƒæ˜¯è¯»æ“ä½œï¼Œå¯¹åº” `GET` è¯·æ±‚ã€‚

è¡¥å……ï¼š

*   å¦‚æœèƒ–å‹æœ‰ä¿®æ”¹æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `@WriteOperation` æ³¨è§£ï¼Œå¯¹åº” `POST` è¯·æ±‚ã€‚
*   å¦‚æœèƒ–å‹æœ‰ä¿®æ”¹æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `@DeleteOperation` æ³¨è§£ï¼Œå¯¹åº” `DELETE` è¯·æ±‚ã€‚
*   å¦‚æœèƒ–å‹æƒ³è¦æ¥æ”¶å‚æ•°ï¼Œå¯ä»¥å‚è€ƒ [LoggersEndpoint](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/logging/LoggersEndpoint.java) ç«¯ç‚¹çš„ä»£ç ã€‚ä¾‹å¦‚è¯´ï¼Œ`@Selector` æ³¨è§£ï¼Œæ¥æ”¶è·¯å¾„å‚æ•°ã€‚

22.2 ç®€å•æµ‹è¯•
---------

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/demo](http://127.0.0.1:8080/actuator/demo) åœ°å€ï¼Œè·å¾—åº”ç”¨çš„ä¿¡æ¯ã€‚å“åº”ç»“æœå¦‚ä¸‹ï¼š

```
{
    "ä½œè€…": "yudaoyuanma",
    "ç§ƒå¤´": "true"
}
```

> **é‡è¦**ï¼šæ›´å¤šå…³äºè‡ªå®šä¹‰ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 2.7. Implementing Custom Endpointsã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-custom)æ–‡æ¡£ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒActuator æœåŠ¡ä½¿ç”¨é…ç½®é¡¹ `server.port` çš„ç«¯å£ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Nginx ä»£ç†åç«¯åº”ç”¨ï¼Œæš´éœ² API æ¥å£æ—¶ï¼Œå¯èƒ½åŒæ—¶ä¹Ÿå°† Actuator çš„ç«¯ç‚¹ä¹Ÿæš´éœ²å‡ºå»äº†ã€‚

æ­¤æ—¶ï¼Œæ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œè®© Actuator æœåŠ¡ä¸ä½¿ç”¨ `server.port` çš„ç«¯å£å³å¯ã€‚æˆ‘ä»¬ä»…ä»…éœ€è¦é…ç½® `management.server.port` ä½¿ç”¨å…¶å®ƒç«¯å£ï¼Œå°±å¯ä»¥å®ç° Actuator è‡ªå®šä¹‰ç«¯å£ã€‚è¿™æ ·ï¼Œå°±èƒ½é¿å…æˆ‘ä»¬å°† Actuator çš„ç«¯ç‚¹ä¹Ÿæš´éœ²å‡ºå»äº†ã€‚

å…·ä½“çš„ç¤ºä¾‹è‰¿è‰¿å°±ä¸æä¾›äº†ï¼Œèƒ–å‹å¯ä»¥åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®ä¸Šæ”¹åŠ¨ä¸‹è¯•è¯•ï¼Œå¾ˆç®€å•ã€‚

> **é‡è¦**ï¼šActuator è¿˜å¯ä»¥è‡ªå®šä¹‰æ¯ä¸ª Endpoint çš„è®¿é—®è·¯å¾„ï¼ŒSSL è¯ä¹¦ç­‰ç­‰ã€‚
> 
> æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 3. Monitoring and Management over HTTPã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-monitoring)æ–‡æ¡£ã€‚

è™½ç„¶è¯´ï¼Œåœ¨[ã€Œ23. è‡ªå®šä¹‰ç«¯å£ã€](#) å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡è‡ªå®šä¹‰ç«¯å£ æ–¹å¼ï¼Œé¿å… Actuator çš„ç«¯ç‚¹æš´éœ²åˆ°å¤–ç½‘ã€‚ä½†æ˜¯æœ¬ç€æ›´é«˜çš„å®‰å…¨çº§åˆ«ï¼Œå†…ç½‘ä¹Ÿä¸ä¸€å®šå¯é çš„åŸåˆ™ï¼Œæˆ‘ä»¬éœ€è¦ç»™ Actuator çš„ç«¯ç‚¹ï¼Œå¢åŠ **å®‰å…¨è®¤è¯**ã€‚ğŸ™‚ æ¯•ç«Ÿï¼ŒæœåŠ¡å™¨å¯èƒ½è¢«é»‘æ‰ï¼Œé»‘å®¢å°±å¯ä»¥è¿å…¥å†…ç½‘ï¼Œé‚£ä¹ˆ Actuator çš„ç«¯ç‚¹å°±ä¼šè¢«è½»æ˜“çš„è®¿é—®ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•´åˆ Spring Security æ¡†æ¶ï¼Œå¿«é€Ÿçš„å®ç°å®‰å…¨è®¤è¯çš„åŠŸèƒ½ã€‚å¦‚æœæ²¡æœ‰å­¦ä¹ è¿‡ Spring Security æ¡†æ¶çš„èƒ–å‹ï¼Œåç»­å¯ä»¥çœ‹çœ‹[ã€ŠèŠ‹é“ Spring Boot å®‰å…¨æ¡†æ¶ Spring Security å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Spring-Security/?self)æ–‡ç« ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥è¿›è¡Œæœ¬å°èŠ‚çš„ç¤ºä¾‹ï¼Œè€ƒè™‘åˆ°ä¸æ±¡æŸ“[ã€Œ2. å¿«é€Ÿå…¥é—¨ã€](#) çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ [lab-34-actuator-demo](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo/) é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª [lab-34-actuator-demo-security](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-security/) é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~

24.1 å¼•å…¥ä¾èµ–
---------

ä¿®æ”¹ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-security/pom.xml) æ–‡ä»¶ä¸­ï¼Œ**é¢å¤–**å¼•å…¥ `spring-boot-starter-security` ç›¸å…³ä¾èµ–ã€‚

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

24.2 é…ç½®æ–‡ä»¶
---------

ä¿®æ”¹ [`application.yml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-security/src/main/resources/application.yaml) é…ç½®ï¼Œå¢åŠ  Spring Security çš„é…ç½®ã€‚é…ç½®å¦‚ä¸‹ï¼š

```
spring:
  
  security:
    
    user:
      name: user 
      password: user 
      roles: ADMIN
```

*   æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè´¦å·ã€Œuser/userã€ï¼Œè§’è‰²ä¸º **ADMIN** ã€‚

24.3 SecurityConfig
-------------------

åœ¨ [`cn.iocoder.springboot.lab34.actuatordemo.config`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-security/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/) åŒ…ä¸‹ï¼Œåˆ›å»º [SecurityConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-34/lab-34-actuator-demo-security/src/main/java/cn/iocoder/springboot/lab34/actuatordemo/config/SecurityConfig.java) é…ç½®ç±»ï¼Œé…ç½® Actuator çš„ç«¯ç‚¹çš„å®‰å…¨è®¤è¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) ->
                requests.anyRequest().hasRole("ADMIN"));
        
        http.httpBasic();
    }

}
```

*   `<1>` å¤„ï¼Œè®¾ç½® Actuator çš„ç«¯ç‚¹çš„è®¿é—®ï¼Œéœ€è¦ç»è¿‡è®¤è¯ï¼Œå¹¶ä¸”æ‹¥æœ‰ ADMIN è§’è‰²ã€‚
*   `<2>` å¤„ï¼Œè®¾ç½®ä½¿ç”¨ [HTTP Basic authentication](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication)ã€‚

24.4 ç®€å•æµ‹è¯•
---------

è°ƒç”¨ `Application#main(Object[] args)` æ–¹æ³•ï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://127.0.0.1:8080/actuator/info](http://127.0.0.1:8080/actuator/info) åœ°å€ï¼Œè¢«å®‰å…¨æ‹¦æˆªï¼Œå¼¹å‡ºç™»å½•çª—å£ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://static.iocoder.cn/images/Spring-Boot/2020-02-01/16.png)

è¾“å…¥ã€Œuser/userã€è´¦å·åï¼Œç™»å½•æˆåŠŸï¼Œæ‰å¯ä»¥è®¿é—®è¯¥ç«¯ç‚¹ã€‚

> **é‡è¦**ï¼šæ›´å¤šå…³äº `health` ç«¯ç‚¹çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥è¡¥å……é˜…è¯»[ã€ŠSpring Boot Actuator: Production-ready Features â€”â€” 2.3. Securing HTTP Endpointsã€‹](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-security)æ–‡æ¡£ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† Spring Boot Actuator çš„å­¦ä¹ ã€‚é€šè¿‡å®ƒæä¾›çš„**å†…ç½®**çš„ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›‘æ§ä¸ç®¡ç†åº”ç”¨ã€‚åŒæ—¶ï¼Œå…¶å®ƒæ¡†æ¶ä¹Ÿå¯ä»¥å®ç°å…¶**æ¡†æ¶çš„ç«¯ç‚¹**ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥**è‡ªå®šä¹‰çš„ç«¯ç‚¹**ã€‚ç›¸å½“äºè¯´ï¼Œ**Spring Boot å®šä¹‰äº†ä¸€å¥—ç»Ÿä¸€çš„åº”ç”¨çš„ç›‘æ§ä¸ç®¡ç†ä½“ç³»**ã€‚

å®é™…ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸å¯èƒ½ç›´æ¥é€šè¿‡è°ƒç”¨ Actuator çš„ç«¯ç‚¹ï¼Œè¿›è¡Œåº”ç”¨çš„ç®¡æ§ä¸ç®¡ç†ï¼Œæ¯•ç«Ÿåº”ç”¨èŠ‚ç‚¹çš„æ•°é‡æ˜¯éå¸¸å¤šçš„ï¼ŒğŸ˜ˆ æˆ‘ä»¬ä¹Ÿè®°ä¸ä½é‚£ä¹ˆå¤šåº”ç”¨çš„åœ°å€ï¼Œå˜¿å˜¿ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æœ‰**æ§åˆ¶å°**ã€‚ç›®å‰æ¯”è¾ƒä¸»æµçš„ï¼Œæœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š

*   Spring Boot Admin ï¼Œå¯é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot ç›‘æ§å·¥å…· Admin å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Admin/?self)æ–‡ç« 
*   Prometheus + Grafana ï¼Œå¯é˜…è¯»[ã€ŠèŠ‹é“ Spring Boot ç›‘æ§å¹³å° Prometheus + Grafana å…¥é—¨ã€‹](http://www.iocoder.cn/Spring-Boot/Prometheus-and-Grafana/?self)æ–‡ç« 

è€ƒè™‘åˆ°å¾ˆå¤šèƒ–å‹çš„è‹±è¯­è·Ÿè‰¿è‰¿ä¸€æ ·æ¸£æ¸£ï¼Œå¯ä»¥ä½¿ç”¨[ã€ŠSpringBoot 2.X ä¸­æ–‡æ–‡æ¡£ â€”â€” äº”ã€Spring Boot Actuator: ç”Ÿäº§å°±ç»ªåŠŸèƒ½ã€‹](https://docshome.gitbooks.io/springboot/content/pages/production-ready.html#production-ready)æ–‡æ¡£ã€‚